{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["turbopack:///[turbopack]/browser/dev/hmr-client/hmr-client.ts"],"sourcesContent":["/// <reference path=\"../../../shared/runtime-types.d.ts\" />\r\n/// <reference path=\"../../runtime/base/dev-globals.d.ts\" />\r\n/// <reference path=\"../../runtime/base/dev-protocol.d.ts\" />\r\n/// <reference path=\"../../runtime/base/dev-extensions.ts\" />\r\n\r\ntype SendMessage = (msg: any) => void\r\nexport type WebSocketMessage =\r\n  | {\r\n      type: 'turbopack-connected'\r\n    }\r\n  | {\r\n      type: 'turbopack-message'\r\n      data: Record<string, any>\r\n    }\r\n\r\nexport type ClientOptions = {\r\n  addMessageListener: (cb: (msg: WebSocketMessage) => void) => void\r\n  sendMessage: SendMessage\r\n  onUpdateError: (err: unknown) => void\r\n}\r\n\r\nexport function connect({\r\n  addMessageListener,\r\n  sendMessage,\r\n  onUpdateError = console.error,\r\n}: ClientOptions) {\r\n  addMessageListener((msg) => {\r\n    switch (msg.type) {\r\n      case 'turbopack-connected':\r\n        handleSocketConnected(sendMessage)\r\n        break\r\n      default:\r\n        try {\r\n          if (Array.isArray(msg.data)) {\r\n            for (let i = 0; i < msg.data.length; i++) {\r\n              handleSocketMessage(msg.data[i] as ServerMessage)\r\n            }\r\n          } else {\r\n            handleSocketMessage(msg.data as ServerMessage)\r\n          }\r\n          applyAggregatedUpdates()\r\n        } catch (e: unknown) {\r\n          console.warn(\r\n            '[Fast Refresh] performing full reload\\n\\n' +\r\n              \"Fast Refresh will perform a full reload when you edit a file that's imported by modules outside of the React rendering tree.\\n\" +\r\n              'You might have a file which exports a React component but also exports a value that is imported by a non-React component file.\\n' +\r\n              'Consider migrating the non-React component export to a separate file and importing it into both files.\\n\\n' +\r\n              'It is also possible the parent component of the component you edited is a class component, which disables Fast Refresh.\\n' +\r\n              'Fast Refresh requires at least one parent function component in your React tree.'\r\n          )\r\n          onUpdateError(e)\r\n          location.reload()\r\n        }\r\n        break\r\n    }\r\n  })\r\n\r\n  const queued = globalThis.TURBOPACK_CHUNK_UPDATE_LISTENERS\r\n  if (queued != null && !Array.isArray(queued)) {\r\n    throw new Error('A separate HMR handler was already registered')\r\n  }\r\n  globalThis.TURBOPACK_CHUNK_UPDATE_LISTENERS = {\r\n    push: ([chunkPath, callback]: [ChunkListPath, UpdateCallback]) => {\r\n      subscribeToChunkUpdate(chunkPath, sendMessage, callback)\r\n    },\r\n  }\r\n\r\n  if (Array.isArray(queued)) {\r\n    for (const [chunkPath, callback] of queued) {\r\n      subscribeToChunkUpdate(chunkPath, sendMessage, callback)\r\n    }\r\n  }\r\n}\r\n\r\ntype UpdateCallbackSet = {\r\n  callbacks: Set<UpdateCallback>\r\n  unsubscribe: () => void\r\n}\r\n\r\nconst updateCallbackSets: Map<ResourceKey, UpdateCallbackSet> = new Map()\r\n\r\nfunction sendJSON(sendMessage: SendMessage, message: ClientMessage) {\r\n  sendMessage(JSON.stringify(message))\r\n}\r\n\r\ntype ResourceKey = string\r\n\r\nfunction resourceKey(resource: ResourceIdentifier): ResourceKey {\r\n  return JSON.stringify({\r\n    path: resource.path,\r\n    headers: resource.headers || null,\r\n  })\r\n}\r\n\r\nfunction subscribeToUpdates(\r\n  sendMessage: SendMessage,\r\n  resource: ResourceIdentifier\r\n): () => void {\r\n  sendJSON(sendMessage, {\r\n    type: 'turbopack-subscribe',\r\n    ...resource,\r\n  })\r\n\r\n  return () => {\r\n    sendJSON(sendMessage, {\r\n      type: 'turbopack-unsubscribe',\r\n      ...resource,\r\n    })\r\n  }\r\n}\r\n\r\nfunction handleSocketConnected(sendMessage: SendMessage) {\r\n  for (const key of updateCallbackSets.keys()) {\r\n    subscribeToUpdates(sendMessage, JSON.parse(key))\r\n  }\r\n}\r\n\r\n// we aggregate all pending updates until the issues are resolved\r\nconst chunkListsWithPendingUpdates: Map<ResourceKey, PartialServerMessage> =\r\n  new Map()\r\n\r\nfunction aggregateUpdates(msg: PartialServerMessage) {\r\n  const key = resourceKey(msg.resource)\r\n  let aggregated = chunkListsWithPendingUpdates.get(key)\r\n\r\n  if (aggregated) {\r\n    aggregated.instruction = mergeChunkListUpdates(\r\n      aggregated.instruction,\r\n      msg.instruction\r\n    )\r\n  } else {\r\n    chunkListsWithPendingUpdates.set(key, msg)\r\n  }\r\n}\r\n\r\nfunction applyAggregatedUpdates() {\r\n  if (chunkListsWithPendingUpdates.size === 0) return\r\n  hooks.beforeRefresh()\r\n  for (const msg of chunkListsWithPendingUpdates.values()) {\r\n    triggerUpdate(msg)\r\n  }\r\n  chunkListsWithPendingUpdates.clear()\r\n  finalizeUpdate()\r\n}\r\n\r\nfunction mergeChunkListUpdates(\r\n  updateA: ChunkListUpdate,\r\n  updateB: ChunkListUpdate\r\n): ChunkListUpdate {\r\n  let chunks\r\n  if (updateA.chunks != null) {\r\n    if (updateB.chunks == null) {\r\n      chunks = updateA.chunks\r\n    } else {\r\n      chunks = mergeChunkListChunks(updateA.chunks, updateB.chunks)\r\n    }\r\n  } else if (updateB.chunks != null) {\r\n    chunks = updateB.chunks\r\n  }\r\n\r\n  let merged\r\n  if (updateA.merged != null) {\r\n    if (updateB.merged == null) {\r\n      merged = updateA.merged\r\n    } else {\r\n      // Since `merged` is an array of updates, we need to merge them all into\r\n      // one, consistent update.\r\n      // Since there can only be `EcmascriptMergeUpdates` in the array, there is\r\n      // no need to key on the `type` field.\r\n      let update = updateA.merged[0]\r\n      for (let i = 1; i < updateA.merged.length; i++) {\r\n        update = mergeChunkListEcmascriptMergedUpdates(\r\n          update,\r\n          updateA.merged[i]\r\n        )\r\n      }\r\n\r\n      for (let i = 0; i < updateB.merged.length; i++) {\r\n        update = mergeChunkListEcmascriptMergedUpdates(\r\n          update,\r\n          updateB.merged[i]\r\n        )\r\n      }\r\n\r\n      merged = [update]\r\n    }\r\n  } else if (updateB.merged != null) {\r\n    merged = updateB.merged\r\n  }\r\n\r\n  return {\r\n    type: 'ChunkListUpdate',\r\n    chunks,\r\n    merged,\r\n  }\r\n}\r\n\r\nfunction mergeChunkListChunks(\r\n  chunksA: Record<ChunkPath, ChunkUpdate>,\r\n  chunksB: Record<ChunkPath, ChunkUpdate>\r\n): Record<ChunkPath, ChunkUpdate> {\r\n  const chunks: Record<ChunkPath, ChunkUpdate> = {}\r\n\r\n  for (const [chunkPath, chunkUpdateA] of Object.entries(chunksA) as Array<\r\n    [ChunkPath, ChunkUpdate]\r\n  >) {\r\n    const chunkUpdateB = chunksB[chunkPath]\r\n    if (chunkUpdateB != null) {\r\n      const mergedUpdate = mergeChunkUpdates(chunkUpdateA, chunkUpdateB)\r\n      if (mergedUpdate != null) {\r\n        chunks[chunkPath] = mergedUpdate\r\n      }\r\n    } else {\r\n      chunks[chunkPath] = chunkUpdateA\r\n    }\r\n  }\r\n\r\n  for (const [chunkPath, chunkUpdateB] of Object.entries(chunksB) as Array<\r\n    [ChunkPath, ChunkUpdate]\r\n  >) {\r\n    if (chunks[chunkPath] == null) {\r\n      chunks[chunkPath] = chunkUpdateB\r\n    }\r\n  }\r\n\r\n  return chunks\r\n}\r\n\r\nfunction mergeChunkUpdates(\r\n  updateA: ChunkUpdate,\r\n  updateB: ChunkUpdate\r\n): ChunkUpdate | undefined {\r\n  if (\r\n    (updateA.type === 'added' && updateB.type === 'deleted') ||\r\n    (updateA.type === 'deleted' && updateB.type === 'added')\r\n  ) {\r\n    return undefined\r\n  }\r\n\r\n  if (updateA.type === 'partial') {\r\n    invariant(updateA.instruction, 'Partial updates are unsupported')\r\n  }\r\n\r\n  if (updateB.type === 'partial') {\r\n    invariant(updateB.instruction, 'Partial updates are unsupported')\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nfunction mergeChunkListEcmascriptMergedUpdates(\r\n  mergedA: EcmascriptMergedUpdate,\r\n  mergedB: EcmascriptMergedUpdate\r\n): EcmascriptMergedUpdate {\r\n  const entries = mergeEcmascriptChunkEntries(mergedA.entries, mergedB.entries)\r\n  const chunks = mergeEcmascriptChunksUpdates(mergedA.chunks, mergedB.chunks)\r\n\r\n  return {\r\n    type: 'EcmascriptMergedUpdate',\r\n    entries,\r\n    chunks,\r\n  }\r\n}\r\n\r\nfunction mergeEcmascriptChunkEntries(\r\n  entriesA: Record<ModuleId, EcmascriptModuleEntry> | undefined,\r\n  entriesB: Record<ModuleId, EcmascriptModuleEntry> | undefined\r\n): Record<ModuleId, EcmascriptModuleEntry> {\r\n  return { ...entriesA, ...entriesB }\r\n}\r\n\r\nfunction mergeEcmascriptChunksUpdates(\r\n  chunksA: Record<ChunkPath, EcmascriptMergedChunkUpdate> | undefined,\r\n  chunksB: Record<ChunkPath, EcmascriptMergedChunkUpdate> | undefined\r\n): Record<ChunkPath, EcmascriptMergedChunkUpdate> | undefined {\r\n  if (chunksA == null) {\r\n    return chunksB\r\n  }\r\n\r\n  if (chunksB == null) {\r\n    return chunksA\r\n  }\r\n\r\n  const chunks: Record<ChunkPath, EcmascriptMergedChunkUpdate> = {}\r\n\r\n  for (const [chunkPath, chunkUpdateA] of Object.entries(chunksA) as Array<\r\n    [ChunkPath, EcmascriptMergedChunkUpdate]\r\n  >) {\r\n    const chunkUpdateB = chunksB[chunkPath]\r\n    if (chunkUpdateB != null) {\r\n      const mergedUpdate = mergeEcmascriptChunkUpdates(\r\n        chunkUpdateA,\r\n        chunkUpdateB\r\n      )\r\n      if (mergedUpdate != null) {\r\n        chunks[chunkPath] = mergedUpdate\r\n      }\r\n    } else {\r\n      chunks[chunkPath] = chunkUpdateA\r\n    }\r\n  }\r\n\r\n  for (const [chunkPath, chunkUpdateB] of Object.entries(chunksB) as Array<\r\n    [ChunkPath, EcmascriptMergedChunkUpdate]\r\n  >) {\r\n    if (chunks[chunkPath] == null) {\r\n      chunks[chunkPath] = chunkUpdateB\r\n    }\r\n  }\r\n\r\n  if (Object.keys(chunks).length === 0) {\r\n    return undefined\r\n  }\r\n\r\n  return chunks\r\n}\r\n\r\nfunction mergeEcmascriptChunkUpdates(\r\n  updateA: EcmascriptMergedChunkUpdate,\r\n  updateB: EcmascriptMergedChunkUpdate\r\n): EcmascriptMergedChunkUpdate | undefined {\r\n  if (updateA.type === 'added' && updateB.type === 'deleted') {\r\n    // These two completely cancel each other out.\r\n    return undefined\r\n  }\r\n\r\n  if (updateA.type === 'deleted' && updateB.type === 'added') {\r\n    const added = []\r\n    const deleted = []\r\n    const deletedModules = new Set(updateA.modules ?? [])\r\n    const addedModules = new Set(updateB.modules ?? [])\r\n\r\n    for (const moduleId of addedModules) {\r\n      if (!deletedModules.has(moduleId)) {\r\n        added.push(moduleId)\r\n      }\r\n    }\r\n\r\n    for (const moduleId of deletedModules) {\r\n      if (!addedModules.has(moduleId)) {\r\n        deleted.push(moduleId)\r\n      }\r\n    }\r\n\r\n    if (added.length === 0 && deleted.length === 0) {\r\n      return undefined\r\n    }\r\n\r\n    return {\r\n      type: 'partial',\r\n      added,\r\n      deleted,\r\n    }\r\n  }\r\n\r\n  if (updateA.type === 'partial' && updateB.type === 'partial') {\r\n    const added = new Set([...(updateA.added ?? []), ...(updateB.added ?? [])])\r\n    const deleted = new Set([\r\n      ...(updateA.deleted ?? []),\r\n      ...(updateB.deleted ?? []),\r\n    ])\r\n\r\n    if (updateB.added != null) {\r\n      for (const moduleId of updateB.added) {\r\n        deleted.delete(moduleId)\r\n      }\r\n    }\r\n\r\n    if (updateB.deleted != null) {\r\n      for (const moduleId of updateB.deleted) {\r\n        added.delete(moduleId)\r\n      }\r\n    }\r\n\r\n    return {\r\n      type: 'partial',\r\n      added: [...added],\r\n      deleted: [...deleted],\r\n    }\r\n  }\r\n\r\n  if (updateA.type === 'added' && updateB.type === 'partial') {\r\n    const modules = new Set([\r\n      ...(updateA.modules ?? []),\r\n      ...(updateB.added ?? []),\r\n    ])\r\n\r\n    for (const moduleId of updateB.deleted ?? []) {\r\n      modules.delete(moduleId)\r\n    }\r\n\r\n    return {\r\n      type: 'added',\r\n      modules: [...modules],\r\n    }\r\n  }\r\n\r\n  if (updateA.type === 'partial' && updateB.type === 'deleted') {\r\n    // We could eagerly return `updateB` here, but this would potentially be\r\n    // incorrect if `updateA` has added modules.\r\n\r\n    const modules = new Set(updateB.modules ?? [])\r\n\r\n    if (updateA.added != null) {\r\n      for (const moduleId of updateA.added) {\r\n        modules.delete(moduleId)\r\n      }\r\n    }\r\n\r\n    return {\r\n      type: 'deleted',\r\n      modules: [...modules],\r\n    }\r\n  }\r\n\r\n  // Any other update combination is invalid.\r\n\r\n  return undefined\r\n}\r\n\r\nfunction invariant(_: never, message: string): never {\r\n  throw new Error(`Invariant: ${message}`)\r\n}\r\n\r\nconst CRITICAL = ['bug', 'error', 'fatal']\r\n\r\nfunction compareByList(list: any[], a: any, b: any) {\r\n  const aI = list.indexOf(a) + 1 || list.length\r\n  const bI = list.indexOf(b) + 1 || list.length\r\n  return aI - bI\r\n}\r\n\r\nconst chunksWithIssues: Map<ResourceKey, Issue[]> = new Map()\r\n\r\nfunction emitIssues() {\r\n  const issues = []\r\n  const deduplicationSet = new Set()\r\n\r\n  for (const [_, chunkIssues] of chunksWithIssues) {\r\n    for (const chunkIssue of chunkIssues) {\r\n      if (deduplicationSet.has(chunkIssue.formatted)) continue\r\n\r\n      issues.push(chunkIssue)\r\n      deduplicationSet.add(chunkIssue.formatted)\r\n    }\r\n  }\r\n\r\n  sortIssues(issues)\r\n\r\n  hooks.issues(issues)\r\n}\r\n\r\nfunction handleIssues(msg: ServerMessage): boolean {\r\n  const key = resourceKey(msg.resource)\r\n  let hasCriticalIssues = false\r\n\r\n  for (const issue of msg.issues) {\r\n    if (CRITICAL.includes(issue.severity)) {\r\n      hasCriticalIssues = true\r\n    }\r\n  }\r\n\r\n  if (msg.issues.length > 0) {\r\n    chunksWithIssues.set(key, msg.issues)\r\n  } else if (chunksWithIssues.has(key)) {\r\n    chunksWithIssues.delete(key)\r\n  }\r\n\r\n  emitIssues()\r\n\r\n  return hasCriticalIssues\r\n}\r\n\r\nconst SEVERITY_ORDER = ['bug', 'fatal', 'error', 'warning', 'info', 'log']\r\nconst CATEGORY_ORDER = [\r\n  'parse',\r\n  'resolve',\r\n  'code generation',\r\n  'rendering',\r\n  'typescript',\r\n  'other',\r\n]\r\n\r\nfunction sortIssues(issues: Issue[]) {\r\n  issues.sort((a, b) => {\r\n    const first = compareByList(SEVERITY_ORDER, a.severity, b.severity)\r\n    if (first !== 0) return first\r\n    return compareByList(CATEGORY_ORDER, a.category, b.category)\r\n  })\r\n}\r\n\r\nconst hooks = {\r\n  beforeRefresh: () => {},\r\n  refresh: () => {},\r\n  buildOk: () => {},\r\n  issues: (_issues: Issue[]) => {},\r\n}\r\n\r\nexport function setHooks(newHooks: typeof hooks) {\r\n  Object.assign(hooks, newHooks)\r\n}\r\n\r\nfunction handleSocketMessage(msg: ServerMessage) {\r\n  sortIssues(msg.issues)\r\n\r\n  handleIssues(msg)\r\n\r\n  switch (msg.type) {\r\n    case 'issues':\r\n      // issues are already handled\r\n      break\r\n    case 'partial':\r\n      // aggregate updates\r\n      aggregateUpdates(msg)\r\n      break\r\n    default:\r\n      // run single update\r\n      const runHooks = chunkListsWithPendingUpdates.size === 0\r\n      if (runHooks) hooks.beforeRefresh()\r\n      triggerUpdate(msg)\r\n      if (runHooks) finalizeUpdate()\r\n      break\r\n  }\r\n}\r\n\r\nfunction finalizeUpdate() {\r\n  hooks.refresh()\r\n  hooks.buildOk()\r\n\r\n  // This is used by the Next.js integration test suite to notify it when HMR\r\n  // updates have been completed.\r\n  // TODO: Only run this in test environments (gate by `process.env.__NEXT_TEST_MODE`)\r\n  if (globalThis.__NEXT_HMR_CB) {\r\n    globalThis.__NEXT_HMR_CB()\r\n    globalThis.__NEXT_HMR_CB = null\r\n  }\r\n}\r\n\r\nfunction subscribeToChunkUpdate(\r\n  chunkListPath: ChunkListPath,\r\n  sendMessage: SendMessage,\r\n  callback: UpdateCallback\r\n): () => void {\r\n  return subscribeToUpdate(\r\n    {\r\n      path: chunkListPath,\r\n    },\r\n    sendMessage,\r\n    callback\r\n  )\r\n}\r\n\r\nexport function subscribeToUpdate(\r\n  resource: ResourceIdentifier,\r\n  sendMessage: SendMessage,\r\n  callback: UpdateCallback\r\n) {\r\n  const key = resourceKey(resource)\r\n  let callbackSet: UpdateCallbackSet\r\n  const existingCallbackSet = updateCallbackSets.get(key)\r\n  if (!existingCallbackSet) {\r\n    callbackSet = {\r\n      callbacks: new Set([callback]),\r\n      unsubscribe: subscribeToUpdates(sendMessage, resource),\r\n    }\r\n    updateCallbackSets.set(key, callbackSet)\r\n  } else {\r\n    existingCallbackSet.callbacks.add(callback)\r\n    callbackSet = existingCallbackSet\r\n  }\r\n\r\n  return () => {\r\n    callbackSet.callbacks.delete(callback)\r\n\r\n    if (callbackSet.callbacks.size === 0) {\r\n      callbackSet.unsubscribe()\r\n      updateCallbackSets.delete(key)\r\n    }\r\n  }\r\n}\r\n\r\nfunction triggerUpdate(msg: ServerMessage) {\r\n  const key = resourceKey(msg.resource)\r\n  const callbackSet = updateCallbackSets.get(key)\r\n  if (!callbackSet) {\r\n    return\r\n  }\r\n\r\n  for (const callback of callbackSet.callbacks) {\r\n    callback(msg)\r\n  }\r\n\r\n  if (msg.type === 'notFound') {\r\n    // This indicates that the resource which we subscribed to either does not exist or\r\n    // has been deleted. In either case, we should clear all update callbacks, so if a\r\n    // new subscription is created for the same resource, it will send a new \"subscribe\"\r\n    // message to the server.\r\n    // No need to send an \"unsubscribe\" message to the server, it will have already\r\n    // dropped the update stream before sending the \"notFound\" message.\r\n    updateCallbackSets.delete(key)\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/context/CustomerStore.tsx"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from 'react';\r\n\r\nexport interface ProductLite {\r\n  _id: string;\r\n  name: string;\r\n  price: number;\r\n  vendorName?: string;\r\n  image?: string;\r\n  stock?: number;\r\n}\r\n\r\nexport interface CartItem {\r\n  product: ProductLite;\r\n  quantity: number;\r\n}\r\n\r\ninterface CustomerStoreState {\r\n  customerId: string | null;\r\n  cart: CartItem[];\r\n  ensureCustomerId: () => Promise<string | null>;\r\n  addToCart: (product: ProductLite, maxStock?: number) => void;\r\n  updateQuantity: (productId: string, quantity: number) => void;\r\n  removeFromCart: (productId: string) => void;\r\n  clearCart: () => void;\r\n  totalPrice: number;\r\n  totalItems: number;\r\n}\r\n\r\nconst CustomerStoreContext = createContext<CustomerStoreState | undefined>(undefined);\r\n\r\nconst API_BASE = 'http://localhost:5000/api';\r\nconst STORAGE_CART_KEY = 'cc_customer_cart';\r\nconst STORAGE_CUSTOMER_KEY = 'cc_customer_id';\r\nconst TEST_CUSTOMER_EMAIL = 'test.customer@demo.com';\r\n\r\nexport function CustomerStoreProvider({ children }: { children: React.ReactNode }) {\r\n  const [customerId, setCustomerId] = useState<string | null>(null);\r\n  const [cart, setCart] = useState<CartItem[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const savedCart = localStorage.getItem(STORAGE_CART_KEY);\r\n    const savedCustomer = localStorage.getItem(STORAGE_CUSTOMER_KEY);\r\n    if (savedCart) {\r\n      try {\r\n        setCart(JSON.parse(savedCart));\r\n      } catch (_) {\r\n        setCart([]);\r\n      }\r\n    }\r\n    if (savedCustomer) {\r\n      setCustomerId(savedCustomer);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.setItem(STORAGE_CART_KEY, JSON.stringify(cart));\r\n  }, [cart]);\r\n\r\n  const ensureCustomerId = async (): Promise<string | null> => {\r\n    if (customerId) return customerId;\r\n    if (typeof window === 'undefined') return null;\r\n\r\n    const stored = localStorage.getItem(STORAGE_CUSTOMER_KEY);\r\n    if (stored) {\r\n      setCustomerId(stored);\r\n      return stored;\r\n    }\r\n\r\n    try {\r\n      const listRes = await fetch(`${API_BASE}/customers`);\r\n      if (listRes.ok) {\r\n        const customers = await listRes.json();\r\n        const existing = customers.find((c: any) => c.email === TEST_CUSTOMER_EMAIL) || customers[0];\r\n        if (existing) {\r\n          localStorage.setItem(STORAGE_CUSTOMER_KEY, existing._id);\r\n          setCustomerId(existing._id);\r\n          return existing._id;\r\n        }\r\n      }\r\n    } catch (_) {\r\n      // ignore and attempt creation\r\n    }\r\n\r\n    try {\r\n      const createRes = await fetch(`${API_BASE}/customers`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          name: 'Test Customer',\r\n          email: TEST_CUSTOMER_EMAIL,\r\n          phone: '9999999999',\r\n          isActive: true,\r\n        }),\r\n      });\r\n      if (!createRes.ok) throw new Error('Failed to create test customer');\r\n      const customer = await createRes.json();\r\n      localStorage.setItem(STORAGE_CUSTOMER_KEY, customer._id);\r\n      setCustomerId(customer._id);\r\n      return customer._id;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const addToCart = (product: ProductLite, maxStock?: number) => {\r\n    setCart((prev) => {\r\n      const existing = prev.find((item) => item.product._id === product._id);\r\n      const limit = typeof maxStock === 'number'\r\n        ? Math.max(0, maxStock)\r\n        : typeof product.stock === 'number'\r\n          ? Math.max(0, product.stock)\r\n          : Infinity;\r\n      const productWithStock = limit !== Infinity ? { ...product, stock: limit } : product;\r\n      if (existing) {\r\n        const nextQty = Math.min(existing.quantity + 1, limit);\r\n        return prev.map((item) => {\r\n          if (item.product._id !== product._id) return item;\r\n          return {\r\n            ...item,\r\n            product: limit === Infinity ? item.product : { ...item.product, stock: limit },\r\n            quantity: nextQty,\r\n          };\r\n        });\r\n      }\r\n      if (limit <= 0) return prev;\r\n      return [...prev, { product: productWithStock, quantity: 1 }];\r\n    });\r\n  };\r\n\r\n  const updateQuantity = (productId: string, quantity: number) => {\r\n    setCart((prev) => {\r\n      return prev\r\n        .map((item) => {\r\n          if (item.product._id !== productId) return item;\r\n          const limit = typeof item.product.stock === 'number' ? Math.max(0, item.product.stock) : Infinity;\r\n          if (limit <= 0) return null;\r\n          const nextQty = Math.min(quantity, limit);\r\n          if (nextQty <= 0) return null;\r\n          return { ...item, quantity: nextQty };\r\n        })\r\n        .filter((item): item is CartItem => Boolean(item));\r\n    });\r\n  };\r\n\r\n  const removeFromCart = (productId: string) => {\r\n    setCart((prev) => prev.filter((item) => item.product._id !== productId));\r\n  };\r\n\r\n  const clearCart = () => setCart([]);\r\n\r\n  const totalPrice = useMemo(\r\n    () => cart.reduce((sum, item) => sum + item.product.price * item.quantity, 0),\r\n    [cart]\r\n  );\r\n\r\n  const totalItems = useMemo(\r\n    () => cart.reduce((sum, item) => sum + item.quantity, 0),\r\n    [cart]\r\n  );\r\n\r\n  const value: CustomerStoreState = {\r\n    customerId,\r\n    cart,\r\n    ensureCustomerId,\r\n    addToCart,\r\n    updateQuantity,\r\n    removeFromCart,\r\n    clearCart,\r\n    totalPrice,\r\n    totalItems,\r\n  };\r\n\r\n  return <CustomerStoreContext.Provider value={value}>{children}</CustomerStoreContext.Provider>;\r\n}\r\n\r\nexport const useCustomerStore = () => {\r\n  const ctx = useContext(CustomerStoreContext);\r\n  if (!ctx) throw new Error('useCustomerStore must be used within CustomerStoreProvider');\r\n  return ctx;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 662, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/customer/BottomNavbar.tsx"],"sourcesContent":["import { useRouter } from 'next/router';\r\nimport Link from 'next/link';\r\n\r\nconst NAV_ITEMS = [\r\n    { href: '/customer/home', label: 'Home', icon: '/customer/assets/icons/home.svg' },\r\n    { href: '/customer/browse-products', label: 'Search', icon: '/customer/assets/icons/search.svg' },\r\n    { href: '/customer/cart', label: 'Cart', icon: '/customer/assets/icons/cart.svg' },\r\n    { href: '/customer/orders', label: 'Orders', icon: '/customer/assets/icons/order.svg' },\r\n    { href: '/customer/profile', label: 'Profile', icon: '/customer/assets/icons/profile.svg' },\r\n];\r\n\r\nexport default function BottomNavbar() {\r\n    const router = useRouter();\r\n\r\n    return (\r\n        <nav className=\"customer-bottom-nav\">\r\n            {NAV_ITEMS.map((item) => {\r\n                // Precise active check: \r\n                // Home only matches exactly, others match by prefix to handle sub-routes\r\n                const is_active = item.href === '/customer/home'\r\n                    ? router.pathname === item.href\r\n                    : router.pathname.startsWith(item.href);\r\n\r\n                return (\r\n                    <Link\r\n                        key={item.href}\r\n                        href={item.href}\r\n                        className={`bottom-nav-item ${is_active ? 'active' : ''}`}\r\n                    >\r\n                        <img\r\n                            src={item.icon}\r\n                            alt={item.label}\r\n                            className=\"nav-icon-img\"\r\n                        />\r\n                    </Link>\r\n                );\r\n            })}\r\n        </nav>\r\n    );\r\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;AAEA,MAAM,YAAY;IACd;QAAE,MAAM;QAAkB,OAAO;QAAQ,MAAM;IAAkC;IACjF;QAAE,MAAM;QAA6B,OAAO;QAAU,MAAM;IAAoC;IAChG;QAAE,MAAM;QAAkB,OAAO;QAAQ,MAAM;IAAkC;IACjF;QAAE,MAAM;QAAoB,OAAO;QAAU,MAAM;IAAmC;IACtF;QAAE,MAAM;QAAqB,OAAO;QAAW,MAAM;IAAqC;CAC7F;AAEc,SAAS;;IACpB,MAAM,SAAS,IAAA,mLAAS;IAExB,qBACI,sMAAC;QAAI,WAAU;kBACV,UAAU,GAAG,CAAC,CAAC;YACZ,yBAAyB;YACzB,yEAAyE;YACzE,MAAM,YAAY,KAAK,IAAI,KAAK,mBAC1B,OAAO,QAAQ,KAAK,KAAK,IAAI,GAC7B,OAAO,QAAQ,CAAC,UAAU,CAAC,KAAK,IAAI;YAE1C,qBACI,sMAAC,+KAAI;gBAED,MAAM,KAAK,IAAI;gBACf,WAAW,CAAC,gBAAgB,EAAE,YAAY,WAAW,IAAI;0BAEzD,cAAA,sMAAC;oBACG,KAAK,KAAK,IAAI;oBACd,KAAK,KAAK,KAAK;oBACf,WAAU;;;;;;eAPT,KAAK,IAAI;;;;;QAW1B;;;;;;AAGZ;GA5BwB;;QACL,mLAAS;;;KADJ"}},
    {"offset": {"line": 748, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/context/AuthContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\n\r\n// ... (imports remain same)\r\n\r\nexport interface User {\r\n    id: string;\r\n    name: string;\r\n    email: string;\r\n    ui_preferences?: {\r\n        theme?: 'light' | 'dark';\r\n    };\r\n}\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    token: string | null;\r\n    is_authenticated: boolean;\r\n    loading: boolean;\r\n    sign_in: (user: User, token: string) => void;\r\n    sign_out: () => void;\r\n    update_theme: (theme: 'light' | 'dark') => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const [user, set_user] = useState<User | null>(null);\r\n    const [token, set_token] = useState<string | null>(null);\r\n    const [loading, set_loading] = useState(true);\r\n\r\n    // Apply theme helper\r\n    const apply_theme = (theme: 'light' | 'dark') => {\r\n        document.body.classList.remove('theme-light', 'theme-dark');\r\n        document.body.classList.add(`theme-${theme}`);\r\n        localStorage.setItem('cc_theme', theme);\r\n    };\r\n\r\n    // Load auth state ONCE\r\n    useEffect(() => {\r\n        const stored_token = localStorage.getItem('auth_token');\r\n        const stored_user = localStorage.getItem('auth_user');\r\n\r\n        if (stored_token && stored_user) {\r\n            set_token(stored_token);\r\n            const parsed_user = JSON.parse(stored_user);\r\n            set_user(parsed_user);\r\n\r\n            // Apply user theme if available, else fall back to local storage or default\r\n            if (parsed_user.ui_preferences?.theme) {\r\n                apply_theme(parsed_user.ui_preferences.theme);\r\n            }\r\n        } else {\r\n            // If not logged in, just ensure local storage theme is title\r\n            const localTheme = localStorage.getItem('cc_theme') as 'light' | 'dark' | null;\r\n            if (localTheme) apply_theme(localTheme);\r\n        }\r\n\r\n        set_loading(false);\r\n    }, []);\r\n\r\n    const sign_in = (user_data: User, token: string) => {\r\n        localStorage.setItem('auth_token', token);\r\n        localStorage.setItem('auth_user', JSON.stringify(user_data));\r\n        set_user(user_data);\r\n        set_token(token);\r\n\r\n        // Apply theme from user data on login\r\n        if (user_data.ui_preferences?.theme) {\r\n            apply_theme(user_data.ui_preferences.theme);\r\n        }\r\n    };\r\n\r\n    const update_theme = async (theme: 'light' | 'dark') => {\r\n        // 1. Optimistic Update\r\n        apply_theme(theme);\r\n\r\n        // 2. Update Context state if user exists\r\n        if (user) {\r\n            const updated_user = {\r\n                ...user,\r\n                ui_preferences: { ...user.ui_preferences, theme }\r\n            };\r\n            set_user(updated_user);\r\n            localStorage.setItem('auth_user', JSON.stringify(updated_user));\r\n\r\n            // 3. Sync with Backend\r\n            if (token) {\r\n                try {\r\n                    await fetch('http://localhost:5000/api/customer/ui-preferences', {\r\n                        method: 'PATCH',\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            'Authorization': `Bearer ${token}`\r\n                        },\r\n                        body: JSON.stringify({ theme })\r\n                    });\r\n                } catch (error) {\r\n                    console.error(\"Failed to sync theme preference\", error);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const sign_out = () => {\r\n        localStorage.removeItem('auth_token');\r\n        localStorage.removeItem('auth_user');\r\n        set_user(null);\r\n        set_token(null);\r\n        window.location.href = '/customer/signin';\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                user,\r\n                token,\r\n                is_authenticated: Boolean(token),\r\n                loading,\r\n                sign_in,\r\n                sign_out,\r\n                update_theme\r\n            }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\n    export const useAuth = () => {\r\n        const ctx = useContext(AuthContext);\r\n        if (!ctx) throw new Error('useAuth must be used within AuthProvider');\r\n        return ctx;\r\n    };\r\n"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAyBA,MAAM,4BAAc,IAAA,uLAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;;IAC9D,MAAM,CAAC,MAAM,SAAS,GAAG,IAAA,kLAAQ,EAAc;IAC/C,MAAM,CAAC,OAAO,UAAU,GAAG,IAAA,kLAAQ,EAAgB;IACnD,MAAM,CAAC,SAAS,YAAY,GAAG,IAAA,kLAAQ,EAAC;IAExC,qBAAqB;IACrB,MAAM,cAAc,CAAC;QACjB,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,eAAe;QAC9C,SAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,OAAO;QAC5C,aAAa,OAAO,CAAC,YAAY;IACrC;IAEA,uBAAuB;IACvB,IAAA,mLAAS;kCAAC;YACN,MAAM,eAAe,aAAa,OAAO,CAAC;YAC1C,MAAM,cAAc,aAAa,OAAO,CAAC;YAEzC,IAAI,gBAAgB,aAAa;gBAC7B,UAAU;gBACV,MAAM,cAAc,KAAK,KAAK,CAAC;gBAC/B,SAAS;gBAET,4EAA4E;gBAC5E,IAAI,YAAY,cAAc,EAAE,OAAO;oBACnC,YAAY,YAAY,cAAc,CAAC,KAAK;gBAChD;YACJ,OAAO;gBACH,6DAA6D;gBAC7D,MAAM,aAAa,aAAa,OAAO,CAAC;gBACxC,IAAI,YAAY,YAAY;YAChC;YAEA,YAAY;QAChB;iCAAG,EAAE;IAEL,MAAM,UAAU,CAAC,WAAiB;QAC9B,aAAa,OAAO,CAAC,cAAc;QACnC,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;QACjD,SAAS;QACT,UAAU;QAEV,sCAAsC;QACtC,IAAI,UAAU,cAAc,EAAE,OAAO;YACjC,YAAY,UAAU,cAAc,CAAC,KAAK;QAC9C;IACJ;IAEA,MAAM,eAAe,OAAO;QACxB,uBAAuB;QACvB,YAAY;QAEZ,yCAAyC;QACzC,IAAI,MAAM;YACN,MAAM,eAAe;gBACjB,GAAG,IAAI;gBACP,gBAAgB;oBAAE,GAAG,KAAK,cAAc;oBAAE;gBAAM;YACpD;YACA,SAAS;YACT,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;YAEjD,uBAAuB;YACvB,IAAI,OAAO;gBACP,IAAI;oBACA,MAAM,MAAM,qDAAqD;wBAC7D,QAAQ;wBACR,SAAS;4BACL,gBAAgB;4BAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;wBACtC;wBACA,MAAM,KAAK,SAAS,CAAC;4BAAE;wBAAM;oBACjC;gBACJ,EAAE,OAAO,OAAO;oBACZ,QAAQ,KAAK,CAAC,mCAAmC;gBACrD;YACJ;QACJ;IACJ;IAEA,MAAM,WAAW;QACb,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,SAAS;QACT,UAAU;QACV,OAAO,QAAQ,CAAC,IAAI,GAAG;IAC3B;IAEA,qBACI,sMAAC,YAAY,QAAQ;QACjB,OAAO;YACH;YACA;YACA,kBAAkB,QAAQ;YAC1B;YACA;YACA;YACA;QACJ;kBAEC;;;;;;AAGb;GArGgB;KAAA;AAuGL,MAAM,UAAU;;IACnB,MAAM,MAAM,IAAA,oLAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACX;IAJa"}},
    {"offset": {"line": 878, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/components/customer/CustomerLayout.tsx"],"sourcesContent":["import Link from 'next/link';\r\nimport { useRouter } from 'next/router';\r\nimport { useEffect, useState } from 'react';\r\nimport BottomNavbar from '../../pages/customer/BottomNavbar';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\nexport default function CustomerLayout({\r\n  children,\r\n  disablePadding = false,\r\n  fullWidth = false\r\n}: {\r\n  children: React.ReactNode;\r\n  disablePadding?: boolean;\r\n  fullWidth?: boolean\r\n}) {\r\n  const router = useRouter();\r\n  const { is_authenticated, loading, onboarding_step, get_route_for_step } = useAuth();\r\n  const [isDark, setIsDark] = useState<boolean>(false);\r\n\r\n  // 1. THEME LOGIC\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const theme = localStorage.getItem('cc_theme');\r\n      const prefersDark = theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches);\r\n      setIsDark(prefersDark);\r\n      if (prefersDark) {\r\n        document.body.classList.add('theme-dark');\r\n      } else {\r\n        document.body.classList.remove('theme-dark');\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // 2. THEME TOGGLE EXPORT\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      (window as any).toggleCustomerTheme = () => {\r\n        const newTheme = !isDark;\r\n        setIsDark(newTheme);\r\n        if (newTheme) {\r\n          document.body.classList.add('theme-dark');\r\n          localStorage.setItem('cc_theme', 'dark');\r\n        } else {\r\n          document.body.classList.remove('theme-dark');\r\n          localStorage.setItem('cc_theme', 'light');\r\n        }\r\n      };\r\n    }\r\n  }, [isDark]);\r\n\r\n  // 3. GLOBAL AUTHENTICATION GUARD\r\n  useEffect(() => {\r\n    // Prevent auto-logout/redirect loop by waiting for AuthContext to finish loading\r\n    if (!loading) {\r\n      if (!is_authenticated) {\r\n        // No valid session found after revalidation\r\n        router.replace('/customer/signin');\r\n      } else if (onboarding_step && onboarding_step !== 'PHONE_VERIFIED') {\r\n        // Session valid but onboarding incomplete\r\n        const correct_route = get_route_for_step(onboarding_step);\r\n        // Prevent infinite redirect if we are already on that route\r\n        if (router.pathname !== correct_route) {\r\n          router.replace(correct_route);\r\n        }\r\n      }\r\n    }\r\n  }, [is_authenticated, loading, onboarding_step, router, get_route_for_step]);\r\n\r\n  // 4. LOADING STATE\r\n  // Show a clean loading screen while AuthContext verifies the token/cookie\r\n  if (loading) {\r\n    return (\r\n      <div style={{\r\n        height: '100vh',\r\n        width: '100vw',\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        backgroundColor: isDark ? '#121212' : '#ffffff',\r\n        color: isDark ? '#ffffff' : '#000000',\r\n        fontFamily: 'sans-serif'\r\n      }}>\r\n        <div style={{ textAlign: 'center' }}>\r\n          <p style={{ fontWeight: '500', fontSize: '16px' }}>Securely loading session...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 5. RENDER PROTECTION\r\n  // If not authenticated and finished loading, render nothing while redirecting\r\n  if (!is_authenticated) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={`customer-shell ${fullWidth ? 'full-width' : ''}`}>\r\n      <main className={`customer-main ${disablePadding ? 'no-padding' : ''} page-transition`}>\r\n        {children}\r\n      </main>\r\n      <BottomNavbar />\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;;;;;AAEe,SAAS,eAAe,EACrC,QAAQ,EACR,iBAAiB,KAAK,EACtB,YAAY,KAAK,EAKlB;;IACC,MAAM,SAAS,IAAA,mLAAS;IACxB,MAAM,EAAE,gBAAgB,EAAE,OAAO,EAAE,eAAe,EAAE,kBAAkB,EAAE,GAAG,IAAA,iLAAO;IAClF,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,kLAAQ,EAAU;IAE9C,iBAAiB;IACjB,IAAA,mLAAS;oCAAC;YACR,wCAAmC;gBACjC,MAAM,QAAQ,aAAa,OAAO,CAAC;gBACnC,MAAM,cAAc,UAAU,UAAW,CAAC,SAAS,OAAO,UAAU,CAAC,gCAAgC,OAAO;gBAC5G,UAAU;gBACV,IAAI,aAAa;oBACf,SAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;gBAC9B,OAAO;oBACL,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBACjC;YACF;QACF;mCAAG,EAAE;IAEL,yBAAyB;IACzB,IAAA,mLAAS;oCAAC;YACR,wCAAmC;gBAChC,OAAe,mBAAmB;gDAAG;wBACpC,MAAM,WAAW,CAAC;wBAClB,UAAU;wBACV,IAAI,UAAU;4BACZ,SAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;4BAC5B,aAAa,OAAO,CAAC,YAAY;wBACnC,OAAO;4BACL,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;4BAC/B,aAAa,OAAO,CAAC,YAAY;wBACnC;oBACF;;YACF;QACF;mCAAG;QAAC;KAAO;IAEX,iCAAiC;IACjC,IAAA,mLAAS;oCAAC;YACR,iFAAiF;YACjF,IAAI,CAAC,SAAS;gBACZ,IAAI,CAAC,kBAAkB;oBACrB,4CAA4C;oBAC5C,OAAO,OAAO,CAAC;gBACjB,OAAO,IAAI,mBAAmB,oBAAoB,kBAAkB;oBAClE,0CAA0C;oBAC1C,MAAM,gBAAgB,mBAAmB;oBACzC,4DAA4D;oBAC5D,IAAI,OAAO,QAAQ,KAAK,eAAe;wBACrC,OAAO,OAAO,CAAC;oBACjB;gBACF;YACF;QACF;mCAAG;QAAC;QAAkB;QAAS;QAAiB;QAAQ;KAAmB;IAE3E,mBAAmB;IACnB,0EAA0E;IAC1E,IAAI,SAAS;QACX,qBACE,sMAAC;YAAI,OAAO;gBACV,QAAQ;gBACR,OAAO;gBACP,SAAS;gBACT,gBAAgB;gBAChB,YAAY;gBACZ,iBAAiB,SAAS,YAAY;gBACtC,OAAO,SAAS,YAAY;gBAC5B,YAAY;YACd;sBACE,cAAA,sMAAC;gBAAI,OAAO;oBAAE,WAAW;gBAAS;0BAChC,cAAA,sMAAC;oBAAE,OAAO;wBAAE,YAAY;wBAAO,UAAU;oBAAO;8BAAG;;;;;;;;;;;;;;;;IAI3D;IAEA,uBAAuB;IACvB,8EAA8E;IAC9E,IAAI,CAAC,kBAAkB;QACrB,OAAO;IACT;IAEA,qBACE,sMAAC;QAAI,WAAW,CAAC,eAAe,EAAE,YAAY,eAAe,IAAI;;0BAC/D,sMAAC;gBAAK,WAAW,CAAC,cAAc,EAAE,iBAAiB,eAAe,GAAG,gBAAgB,CAAC;0BACnF;;;;;;0BAEH,sMAAC,4LAAY;;;;;;;;;;;AAGnB;GAjGwB;;QASP,mLAAS;QACmD,iLAAO;;;KAV5D"}},
    {"offset": {"line": 1044, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/components/ui/ToastProvider.tsx"],"sourcesContent":["import React, { createContext, useCallback, useContext, useMemo, useState } from 'react';\r\n\r\nexport type ToastType = 'success' | 'error' | 'info' | 'warning';\r\n\r\nexport interface Toast {\r\n  id: string;\r\n  type: ToastType;\r\n  title?: string;\r\n  message: string;\r\n  duration?: number; // ms\r\n}\r\n\r\ninterface ToastContextValue {\r\n  pushToast: (toast: Omit<Toast, 'id'>) => void;\r\n  showToast: (message: string, type?: ToastType) => void;\r\n}\r\n\r\nconst ToastContext = createContext<ToastContextValue | undefined>(undefined);\r\n\r\nexport const useToast = () => {\r\n  const ctx = useContext(ToastContext);\r\n  if (!ctx) throw new Error('useToast must be used within ToastProvider');\r\n  return ctx;\r\n};\r\n\r\nexport const ToastProvider: React.FC<React.PropsWithChildren<{}>> = ({ children }) => {\r\n  const [toasts, setToasts] = useState<Toast[]>([]);\r\n\r\n  const remove = useCallback((id: string) => {\r\n    setToasts((prev) => prev.filter((t) => t.id !== id));\r\n  }, []);\r\n\r\n  const pushToast = useCallback((toast: Omit<Toast, 'id'>) => {\r\n    const id = Math.random().toString(36).slice(2);\r\n    const duration = toast.duration ?? 4000;\r\n    const t: Toast = { id, ...toast, duration };\r\n    setToasts((prev) => [t, ...prev]);\r\n    window.setTimeout(() => remove(id), duration);\r\n  }, [remove]);\r\n\r\n  const showToast = useCallback((message: string, type: ToastType = 'info') => {\r\n    pushToast({ message, type });\r\n  }, [pushToast]);\r\n\r\n  const value = useMemo(() => ({ pushToast, showToast }), [pushToast, showToast]);\r\n\r\n  return (\r\n    <ToastContext.Provider value={value}>\r\n      {children}\r\n      <div className=\"toast-container\" aria-live=\"polite\" aria-atomic=\"true\">\r\n        {toasts.map((t) => (\r\n          <div key={t.id} className={`toast ${t.type}`}>\r\n            {t.title && <div className=\"toast-title\">{t.title}</div>}\r\n            <div className=\"toast-message\">{t.message}</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </ToastContext.Provider>\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAAA;;;;AAiBA,MAAM,6BAAe,IAAA,uLAAa,EAAgC;AAE3D,MAAM,WAAW;;IACtB,MAAM,MAAM,IAAA,oLAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;GAJa;AAMN,MAAM,gBAAuD,CAAC,EAAE,QAAQ,EAAE;;IAC/E,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,kLAAQ,EAAU,EAAE;IAEhD,MAAM,SAAS,IAAA,qLAAW;6CAAC,CAAC;YAC1B;qDAAU,CAAC,OAAS,KAAK,MAAM;6DAAC,CAAC,IAAM,EAAE,EAAE,KAAK;;;QAClD;4CAAG,EAAE;IAEL,MAAM,YAAY,IAAA,qLAAW;gDAAC,CAAC;YAC7B,MAAM,KAAK,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC;YAC5C,MAAM,WAAW,MAAM,QAAQ,IAAI;YACnC,MAAM,IAAW;gBAAE;gBAAI,GAAG,KAAK;gBAAE;YAAS;YAC1C;wDAAU,CAAC,OAAS;wBAAC;2BAAM;qBAAK;;YAChC,OAAO,UAAU;wDAAC,IAAM,OAAO;uDAAK;QACtC;+CAAG;QAAC;KAAO;IAEX,MAAM,YAAY,IAAA,qLAAW;gDAAC,CAAC,SAAiB,OAAkB,MAAM;YACtE,UAAU;gBAAE;gBAAS;YAAK;QAC5B;+CAAG;QAAC;KAAU;IAEd,MAAM,QAAQ,IAAA,iLAAO;wCAAC,IAAM,CAAC;gBAAE;gBAAW;YAAU,CAAC;uCAAG;QAAC;QAAW;KAAU;IAE9E,qBACE,sMAAC,aAAa,QAAQ;QAAC,OAAO;;YAC3B;0BACD,sMAAC;gBAAI,WAAU;gBAAkB,aAAU;gBAAS,eAAY;0BAC7D,OAAO,GAAG,CAAC,CAAC,kBACX,sMAAC;wBAAe,WAAW,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE;;4BACzC,EAAE,KAAK,kBAAI,sMAAC;gCAAI,WAAU;0CAAe,EAAE,KAAK;;;;;;0CACjD,sMAAC;gCAAI,WAAU;0CAAiB,EAAE,OAAO;;;;;;;uBAFjC,EAAE,EAAE;;;;;;;;;;;;;;;;AAQxB;IAlCa;KAAA"}},
    {"offset": {"line": 1172, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/customer/checkout.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport { useCustomerStore } from '../../context/CustomerStore';\r\nimport CustomerLayout from '../../components/customer/CustomerLayout';\r\nimport { useToast } from '../../components/ui/ToastProvider';\r\n\r\nexport default function CheckoutPage() {\r\n    const router = useRouter();\r\n    const { cart, totalPrice, totalItems } = useCustomerStore();\r\n    const { pushToast } = useToast();\r\n\r\n    // Address State\r\n    const [addressType, setAddressType] = useState<'Main' | 'Second'>('Main');\r\n\r\n    const handlePlaceOrder = () => {\r\n        // 1. Validate Cart\r\n        if (cart.length === 0) {\r\n            pushToast({ type: 'error', title: 'Empty Cart', message: 'Add items before checking out' });\r\n            return;\r\n        }\r\n\r\n        // 2. Validate Address (Implicitly always selected by toggle default, but good to check)\r\n        if (!addressType) {\r\n            pushToast({ type: 'error', title: 'Address Required', message: 'Please select an address' });\r\n            return;\r\n        }\r\n\r\n        // 3. Log Payload\r\n        const payload = {\r\n            cartItems: cart.map(item => ({\r\n                id: item.product._id,\r\n                name: item.product.name,\r\n                price: item.product.price,\r\n                quantity: item.quantity,\r\n                total: item.product.price * item.quantity\r\n            })),\r\n            totalAmount: totalPrice,\r\n            selectedAddress: addressType\r\n        };\r\n\r\n        console.log('Place Order Payload:', payload);\r\n        pushToast({ type: 'success', title: 'Order Placed', message: 'Order logged to console!' });\r\n\r\n        // Optional: clear cart or navigate away? \r\n        // User requirement: \"Log payload structure in console\". \r\n        // Stub logic is fine. I won't clear cart to maintain state for demo unless asked.\r\n    };\r\n\r\n    return (\r\n        <CustomerLayout disablePadding={true}>\r\n            {/* Import CSS here or in _app, but since we are using CSS modules or global, \r\n          and Next.js pages usually require global import in _app, \r\n          we might need to use a <style> tag or ensure the CSS file is imported. \r\n          Given the constraints \"Plain CSS\", I will assume we can import it directly \r\n          if configured, or I will use a scoped approach.\r\n          To be safe with Next.js standard CSS support:\r\n      */}\r\n            <style jsx global>{`\r\n        @import url('/customer/assets/css/checkout.css'); \r\n        /* Since we can't easily add to global build pipeline here, \r\n           I wrote to checkout.css. I will try to direct import it if Next.js allows, \r\n           otherwise I'll inline the critical styles or rely on the written file being imported somewhere.\r\n           Wait, locally created CSS files in pages directory usually need to be imported.\r\n        */\r\n      `}</style>\r\n            {/* \r\n        Actually, the best way given the setup is to import the CSS file directly if Next.js config allows global css from anywhere (likely not) \r\n        or use CSS Modules. The user said \"React + plain CSS\".\r\n        Let's try a direct import at top.\r\n      */}\r\n\r\n            <div className=\"checkout-page\">\r\n\r\n                {/* 1. Page Header */}\r\n                <header className=\"checkout-header\">\r\n                    <button className=\"checkout-back-btn\" onClick={() => router.back()}>\r\n                        {/* Using existing icon asset if available, else simple arrow */}\r\n                        <img src=\"/customer/assets/icons/backward.svg\" alt=\"Back\" width={24} height={24} />\r\n                    </button>\r\n                    <h1 className=\"checkout-title\">Checkout</h1>\r\n                </header>\r\n\r\n                {/* 2. Order Summary (Scrollable) */}\r\n                <section className=\"order-summary-section\">\r\n                    <h2 className=\"summary-title\">Order Summary</h2>\r\n\r\n                    <div className=\"summary-list\">\r\n                        {cart.map((item) => (\r\n                            <div key={item.product._id} className=\"summary-row\">\r\n                                <div className=\"item-info\">\r\n                                    <span className=\"item-name\">{item.product.name}</span>\r\n                                    <span className=\"item-qty\">x {item.quantity}</span>\r\n                                </div>\r\n                                <span className=\"item-price\">{(item.product.price * item.quantity).toFixed(2)}</span>\r\n                            </div>\r\n                        ))}\r\n                        {cart.length === 0 && (\r\n                            <p className=\"summary-row\" style={{ justifyContent: 'center', opacity: 0.5 }}>No items in cart</p>\r\n                        )}\r\n                    </div>\r\n                </section>\r\n\r\n                {/* 3. Fixed Bottom Summary Section */}\r\n                <footer className=\"bottom-summary-section\">\r\n                    {/* Items Count and Total */}\r\n                    {/* Requirement says:\r\n               Items 6\r\n               Total 58.20\r\n               Layout: \"Items\" label ... \"6\" value\r\n               \"Total\" label ... \"58.20\" value\r\n               Or grouped? The request says:\r\n               - Items count (Example: Items 6)\r\n               - Total amount (Example: Total 58.20)\r\n               The screenshot implies separate rows or a clean summary block. \r\n               The mockup shows:\r\n               Items       6\r\n               Total   58.2\r\n           */}\r\n\r\n                    <div className=\"bottom-row\">\r\n                        <span className=\"bottom-label\">Items</span>\r\n                        <span className=\"bottom-value\">{totalItems}</span>\r\n                    </div>\r\n\r\n                    <div className=\"bottom-row total-row\">\r\n                        <span className=\"bottom-label\">Total</span>\r\n                        <span className=\"bottom-value\">{totalPrice.toFixed(2)}</span>\r\n                    </div>\r\n\r\n                    {/* Address Selector */}\r\n                    <div className=\"address-selector\">\r\n                        <button\r\n                            className={`address-pill ${addressType === 'Main' ? 'active' : ''}`}\r\n                            onClick={() => setAddressType('Main')}\r\n                        >\r\n                            Main\r\n                        </button>\r\n                        <button\r\n                            className={`address-pill ${addressType === 'Second' ? 'active' : ''}`}\r\n                            onClick={() => setAddressType('Second')}\r\n                        >\r\n                            Second\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Place Order Button */}\r\n                    <button className=\"place-order-btn\" onClick={handlePlaceOrder}>\r\n                        Place Order\r\n                    </button>\r\n                </footer>\r\n            </div>\r\n        </CustomerLayout>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1498, "column": 0}, "map": {"version":3,"sources":["turbopack:///[next]/entry/page-loader.ts"],"sourcesContent":["const PAGE_PATH = \"/customer/checkout\";\n\n/// <reference types=\"next/client\" />\r\n\r\n// inserted by rust code\r\ndeclare const PAGE_PATH: string\r\n\r\n  // Adapted from https://github.com/vercel/next.js/blob/b7f9f1f98fc8ab602e84825105b5727272b72e7d/packages/next/src/build/webpack/loaders/next-client-pages-loader.ts\r\n;(window.__NEXT_P = window.__NEXT_P || []).push([\r\n  PAGE_PATH,\r\n  () => {\r\n    return require('PAGE')\r\n  },\r\n])\r\n// @ts-expect-error module.hot exists\r\nif (module.hot) {\r\n  // @ts-expect-error module.hot exists\r\n  module.hot.dispose(function () {\r\n    window.__NEXT_P.push([PAGE_PATH])\r\n  })\r\n}\r\n"],"names":[],"mappings":"AAAA,MAAM,YAAY;AAQjB,CAAC,OAAO,QAAQ,GAAG,OAAO,QAAQ,IAAI,EAAE,EAAE,IAAI,CAAC;IAC9C;IACA;QACE;IACF;CACD;AACD,qCAAqC;AACrC,IAAI,OAAO,GAAG,EAAE;IACd,qCAAqC;IACrC,OAAO,GAAG,CAAC,OAAO,CAAC;QACjB,OAAO,QAAQ,CAAC,IAAI,CAAC;YAAC;SAAU;IAClC;AACF","ignoreList":[0]}}]
}