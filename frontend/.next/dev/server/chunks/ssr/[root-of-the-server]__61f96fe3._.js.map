{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/components/onboarding/OnboardingLayout.tsx"],"sourcesContent":["import { ReactNode } from 'react';\r\n\r\ninterface OnboardingLayoutProps {\r\n    children: ReactNode;\r\n}\r\n\r\nexport default function OnboardingLayout({ children }: OnboardingLayoutProps) {\r\n    return (\r\n        <div className=\"onboarding-layout\">\r\n            <div className=\"onboarding-content\">\r\n                {children}\r\n            </div>\r\n            <style jsx>{`\r\n                .onboarding-layout {\r\n                    min-height: 100vh;\r\n                    width: 100%;\r\n                    background: var(--bg-primary);\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                }\r\n\r\n                .onboarding-content {\r\n                    flex: 1;\r\n                    width: 100%;\r\n                    max-width: 100%;\r\n                    margin: 0 auto;\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAMe,SAAS,iBAAiB,EAAE,QAAQ,EAAyB;IACxE,qBACI,qKAAC;kDAAc;;0BACX,qKAAC;0DAAc;0BACV;;;;;;;;;;;;;;;;AAoBjB"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/components/onboarding/OnboardingAddress.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useToast } from '../ui/ToastProvider';\r\n\r\nexport default function OnboardingAddress() {\r\n    const router = useRouter();\r\n    const { onboardingStep, getRouteForStep, setOnboardingStep } = useAuth();\r\n    const { showToast } = useToast();\r\n\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Form State - Only 4 fields as specified\r\n    const [form, setForm] = useState({\r\n        flatNo: '',\r\n        floorNo: '',\r\n        blockName: '',\r\n        community: 'Community Cart'\r\n    });\r\n\r\n    // ROUTE GUARD: Enforce onboarding step requirements\r\n    useEffect(() => {\r\n        const allowedSteps = ['PHONE_VERIFIED', 'ADDRESS_PENDING'];\r\n\r\n        if (onboardingStep && !allowedSteps.includes(onboardingStep)) {\r\n            // User is at wrong step - redirect to correct route\r\n            const correctRoute = getRouteForStep(onboardingStep);\r\n            router.replace(correctRoute);\r\n        } else if (!onboardingStep) {\r\n            // No onboarding step set - shouldn't be here\r\n            router.replace('/customer/signin');\r\n        } else if (onboardingStep === 'PHONE_VERIFIED') {\r\n            // Set to ADDRESS_PENDING when entering address page\r\n            setOnboardingStep('ADDRESS_PENDING');\r\n        }\r\n    }, [onboardingStep, router, getRouteForStep, setOnboardingStep]);\r\n\r\n    const handleChange = (field: string, value: string) => {\r\n        setForm(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        // Validate required fields (Floor No is optional)\r\n        if (!form.flatNo || !form.blockName || !form.community) {\r\n            showToast('Please fill all required fields', 'error');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        try {\r\n            // FIX: Now that the user is authenticated from verify-otp, \r\n            // we call the backend directly to persist the address.\r\n            const payload = {\r\n                line1: `Flat ${form.flatNo}, Floor ${form.floorNo}, ${form.blockName}`,\r\n                line2: form.community,\r\n                area: form.community,\r\n                city: 'Hyderabad',\r\n                state: 'Telangana',\r\n                pincode: '500000',\r\n                is_primary: true\r\n            };\r\n\r\n            const res = await fetch('http://localhost:5000/api/customers/addresses', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload),\r\n                credentials: 'include' // Sends JWT cookie\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const errorData = await res.json();\r\n                throw new Error(errorData.message || 'Failed to save address');\r\n            }\r\n\r\n            showToast('Address saved successfully', 'success');\r\n\r\n            // FIX: Clear onboarding step to signify completion\r\n            setOnboardingStep(null);\r\n\r\n            // FIX: Redirect directly to home instead of signin/logout\r\n            router.push('/customer/home');\r\n\r\n        } catch (error: any) {\r\n            showToast(error.message || 'Error saving address', 'error');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"onboarding-address-container\">\r\n            {/* Header */}\r\n            <header className=\"onboarding-address-header\">\r\n                <h1 className=\"onboarding-address-title\">Add Delivery Address</h1>\r\n            </header>\r\n\r\n            <div style={{ height: '32px' }}></div>\r\n\r\n            {/* Form */}\r\n            <div className=\"onboarding-address-form\">\r\n\r\n                {/* Community - Read Only */}\r\n                <div className=\"onboarding-address-input-group\">\r\n                    <div className=\"onboarding-address-input-wrapper\">\r\n                        <label className=\"onboarding-address-label\">Community / Apartment Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"onboarding-address-input\"\r\n                            value={form.community}\r\n                            readOnly\r\n                            style={{ backgroundColor: '#f5f5f5' }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Block Name */}\r\n                <div className=\"onboarding-address-input-group\">\r\n                    <div className=\"onboarding-address-input-wrapper\">\r\n                        <label className=\"onboarding-address-label\">Block / Building Name *</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            className=\"onboarding-address-input\"\r\n                            value={form.blockName}\r\n                            onChange={(e) => handleChange('blockName', e.target.value)}\r\n                            placeholder=\"e.g. Block A\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Floor No & Flat No */}\r\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>\r\n                    <div className=\"onboarding-address-input-group\">\r\n                        <div className=\"onboarding-address-input-wrapper\">\r\n                            <label className=\"onboarding-address-label\">Floor No</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"onboarding-address-input\"\r\n                                value={form.floorNo}\r\n                                onChange={(e) => handleChange('floorNo', e.target.value)}\r\n                                placeholder=\"e.g. 5\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"onboarding-address-input-group\">\r\n                        <div className=\"onboarding-address-input-wrapper\">\r\n                            <label className=\"onboarding-address-label\">Flat / House No *</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                className=\"onboarding-address-input\"\r\n                                value={form.flatNo}\r\n                                onChange={(e) => handleChange('flatNo', e.target.value)}\r\n                                placeholder=\"e.g. 504\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            {/* CTA */}\r\n            <div className=\"onboarding-address-cta-container\">\r\n                <button\r\n                    className=\"onboarding-address-cta-btn\"\r\n                    onClick={handleSubmit}\r\n                    disabled={loading}\r\n                >\r\n                    {loading ? 'Saving...' : 'Save Address'}\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 361, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/onboarding/address.tsx"],"sourcesContent":["import OnboardingLayout from '../../components/onboarding/OnboardingLayout';\r\nimport OnboardingAddress from '../../components/onboarding/OnboardingAddress';\r\n\r\nexport default function OnboardingAddressPage() {\r\n    return (\r\n        <OnboardingLayout>\r\n            <OnboardingAddress />\r\n        </OnboardingLayout>\r\n    );\r\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEe,SAAS;IACpB,qBACI,qKAAC,oMAAgB;kBACb,cAAA,qKAAC,qMAAiB;;;;;;;;;;AAG9B"}}]
}