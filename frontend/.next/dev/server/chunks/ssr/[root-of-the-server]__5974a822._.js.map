{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/services/api.ts"],"sourcesContent":["const API_BASE = 'http://localhost:5000/api';\r\n\r\nlet auth_token: string | null = null;\r\n\r\nexport const setAuthToken = (token: string | null) => {\r\n  auth_token = token;\r\n};\r\n\r\nconst authHeaders = (extra: Record<string, string> = {}) => {\r\n  const headers: Record<string, string> = { ...extra };\r\n  if (auth_token) headers['Authorization'] = `Bearer ${auth_token}`;\r\n  return headers;\r\n};\r\n\r\nexport const api = {\r\n  // Vendors\r\n  vendors: {\r\n    create: async (data: any) => {\r\n      const response = await fetch(`${API_BASE}/vendors`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data),\r\n      });\r\n      if (!response.ok) throw new Error('Failed to create vendor');\r\n      return response.json();\r\n    },\r\n    getAll: async () => {\r\n      const response = await fetch(`${API_BASE}/vendors`);\r\n      if (!response.ok) throw new Error('Failed to fetch vendors');\r\n      return response.json();\r\n    },\r\n    getById: async (id: string, opts?: { includePassword?: boolean }) => {\r\n      const params = new URLSearchParams();\r\n      if (opts?.includePassword) params.append('includePassword', 'true');\r\n      const suffix = params.toString() ? `?${params.toString()}` : '';\r\n      const response = await fetch(`${API_BASE}/vendors/${id}${suffix}`);\r\n      if (!response.ok) throw new Error('Failed to fetch vendor');\r\n      return response.json();\r\n    },\r\n    update: async (id: string, data: any) => {\r\n      const response = await fetch(`${API_BASE}/vendors/${id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data),\r\n      });\r\n      if (!response.ok) throw new Error('Failed to update vendor');\r\n      return response.json();\r\n    },\r\n    forceLogout: async (id: string) => {\r\n      const response = await fetch(`${API_BASE}/vendors/${id}/force-logout`, {\r\n        method: 'POST',\r\n      });\r\n      if (!response.ok) throw new Error('Failed to force logout vendor');\r\n      return response.json();\r\n    },\r\n    delete: async (id: string) => {\r\n      const response = await fetch(`${API_BASE}/vendors/${id}`, {\r\n        method: 'DELETE',\r\n      });\r\n      if (!response.ok) throw new Error('Failed to delete vendor');\r\n      return response.json();\r\n    },\r\n  },\r\n\r\n  // Auth\r\n  auth: {\r\n    register: async (data: any) => {\r\n      const response = await fetch(`${API_BASE}/auth/register`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data),\r\n      });\r\n      const body = await response.json();\r\n      if (!response.ok) throw new Error(body.message || 'Failed to register');\r\n      return body;\r\n    },\r\n    login: async (data: any) => {\r\n      const response = await fetch(`${API_BASE}/auth/login`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data),\r\n      });\r\n      const body = await response.json();\r\n      if (!response.ok) throw new Error(body.message || 'Failed to login');\r\n      return body;\r\n    },\r\n    me: async () => {\r\n      const response = await fetch(`${API_BASE}/auth/me`, {\r\n        headers: authHeaders(),\r\n      });\r\n      const body = await response.json();\r\n      if (!response.ok) throw new Error(body.message || 'Failed to fetch user');\r\n      return body;\r\n    },\r\n    changePassword: async (currentPassword: string, newPassword: string) => {\r\n      const response = await fetch(`${API_BASE}/auth/change-password`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n        body: JSON.stringify({ currentPassword, newPassword }),\r\n      });\r\n      const body = await response.json();\r\n      if (!response.ok) throw new Error(body.message || 'Failed to change password');\r\n      return body;\r\n    },\r\n  },\r\n\r\n  // Customers\r\n  customers: {\r\n    create: async (data: any) => {\r\n      const response = await fetch(`${API_BASE}/customers`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data),\r\n      });\r\n      if (!response.ok) throw new Error('Failed to create customer');\r\n      return response.json();\r\n    },\r\n    getAll: async () => {\r\n      const response = await fetch(`${API_BASE}/customers`);\r\n      if (!response.ok) throw new Error('Failed to fetch customers');\r\n      return response.json();\r\n    },\r\n  },\r\n\r\n  // Products\r\n  products: {\r\n    create: async (data: any) => {\r\n      const response = await fetch(`${API_BASE}/products`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data),\r\n      });\r\n      if (!response.ok) throw new Error('Failed to create product');\r\n      return response.json();\r\n    },\r\n    getAll: async () => {\r\n      const response = await fetch(`${API_BASE}/products`);\r\n      if (!response.ok) throw new Error('Failed to fetch products');\r\n      return response.json();\r\n    },\r\n    getById: async (id: string) => {\r\n      const response = await fetch(`${API_BASE}/products/${id}`);\r\n      if (!response.ok) throw new Error('Failed to fetch product');\r\n      return response.json();\r\n    },\r\n    update: async (id: string, data: any) => {\r\n      const response = await fetch(`${API_BASE}/products/${id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data),\r\n      });\r\n      if (!response.ok) throw new Error('Failed to update product');\r\n      return response.json();\r\n    },\r\n    delete: async (id: string) => {\r\n      const response = await fetch(`${API_BASE}/products/${id}`, {\r\n        method: 'DELETE',\r\n      });\r\n      if (!response.ok) throw new Error('Failed to delete product');\r\n      return response.json();\r\n    },\r\n  },\r\n\r\n  // Product Sales Analytics\r\n  productSales: {\r\n    getAnalytics: async (vendorId: string, filters?: {\r\n      startDate?: string;\r\n      endDate?: string;\r\n      search?: string;\r\n      category?: string;\r\n      stockStatus?: string;\r\n      minUnitsSold?: number;\r\n      minRevenue?: number;\r\n      zeroSalesOnly?: boolean;\r\n      page?: number;\r\n      limit?: number;\r\n      sortBy?: string;\r\n      sortOrder?: 'asc' | 'desc';\r\n      productId?: string;\r\n    }) => {\r\n      const params = new URLSearchParams();\r\n      params.append('vendorId', vendorId);\r\n      if (filters) {\r\n        Object.entries(filters).forEach(([key, value]) => {\r\n          if (value !== undefined && value !== null && value !== '') {\r\n            params.append(key, String(value));\r\n          }\r\n        });\r\n      }\r\n      const response = await fetch(`${API_BASE}/product-sales/analytics?${params.toString()}`);\r\n      if (!response.ok) throw new Error('Failed to fetch product sales analytics');\r\n      return response.json();\r\n    },\r\n    getKPIs: async (vendorId: string, filters?: {\r\n      startDate?: string;\r\n      endDate?: string;\r\n    }) => {\r\n      const params = new URLSearchParams();\r\n      params.append('vendorId', vendorId);\r\n      if (filters?.startDate) params.append('startDate', filters.startDate);\r\n      if (filters?.endDate) params.append('endDate', filters.endDate);\r\n      const response = await fetch(`${API_BASE}/product-sales/kpis?${params.toString()}`);\r\n      if (!response.ok) throw new Error('Failed to fetch KPIs');\r\n      return response.json();\r\n    },\r\n    getProductDetail: async (productId: string, vendorId: string, filters?: {\r\n      startDate?: string;\r\n      endDate?: string;\r\n    }) => {\r\n      const params = new URLSearchParams();\r\n      params.append('vendorId', vendorId);\r\n      if (filters?.startDate) params.append('startDate', filters.startDate);\r\n      if (filters?.endDate) params.append('endDate', filters.endDate);\r\n      const response = await fetch(`${API_BASE}/product-sales/detail/${productId}?${params.toString()}`);\r\n      if (!response.ok) throw new Error('Failed to fetch product detail');\r\n      return response.json();\r\n    },\r\n  },\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/utils/authRedirect.utils.ts"],"sourcesContent":["/**\r\n * Role-aware redirect resolver\r\n * Pure function with no side effects\r\n */\r\n\r\nexport type UserRole = 'customer' | 'vendor' | 'admin';\r\n\r\n/**\r\n * Get the correct login/signin page based on user role\r\n * @param role - User role (optional)\r\n * @returns Redirect path\r\n */\r\nexport function getLoginRedirectPath(role?: UserRole | string | null): string {\r\n    if (role === 'admin' || role === 'vendor') {\r\n        return '/login';\r\n    }\r\n    // vendor, admin, or unknown → /login\r\n    return '/customer/signin';\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AASM,SAAS,qBAAqB,IAA+B;IAChE,IAAI,SAAS,WAAW,SAAS,UAAU;QACvC,OAAO;IACX;IACA,qCAAqC;IACrC,OAAO;AACX"}},
    {"offset": {"line": 293, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/context/AuthContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\n\r\n/**\r\n * ═══════════════════════════════════════════════════════════════════════\r\n * AUTH CONTRACT - DO NOT MODIFY WITHOUT REVIEW\r\n * ═══════════════════════════════════════════════════════════════════════\r\n * \r\n * TOKEN SOURCE: localStorage ONLY\r\n * - Key name: 'auth_token'\r\n * - No cookies, no sessionStorage, no alternatives\r\n * \r\n * LOGOUT: Must go through AuthContext.sign_out() ONLY\r\n * - No component may clear localStorage directly\r\n * - No duplicate logout logic allowed\r\n * \r\n * TOKEN ACCESS: No component may read token directly\r\n * - Use useAuth() hook to access auth state\r\n * - api.utils.ts is the only file that reads localStorage.getItem('auth_token')\r\n * \r\n * REHYDRATION: Identity only\r\n * - Reads auth_user + auth_token from localStorage\r\n * - Does NOT call /me\r\n * - Does NOT validate token\r\n * \r\n * ═══════════════════════════════════════════════════════════════════════\r\n */\r\n\r\nexport interface User {\r\n    id: string;\r\n    name: string;\r\n    email: string;\r\n    phone?: string;\r\n    profile_pic?: string;\r\n    addresses?: any[];\r\n    role?: 'customer' | 'vendor' | 'admin';\r\n    ui_preferences?: {\r\n        theme?: 'light' | 'dark';\r\n    };\r\n}\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    token: string | null;\r\n    role: 'customer' | 'vendor' | 'admin' | null;\r\n    is_authenticated: boolean;\r\n    loading: boolean;\r\n    sign_in: (user: User, token: string) => void;\r\n    sign_out: () => void;\r\n    update_theme: (theme: 'light' | 'dark') => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const [user, set_user] = useState<User | null>(null);\r\n    const [token, set_token] = useState<string | null>(null);\r\n    const [role, set_role] = useState<'customer' | 'vendor' | 'admin' | null>(null);\r\n    const [loading, set_loading] = useState(true);\r\n\r\n    // Apply theme helper (local only)\r\n    const apply_theme = (theme: 'light' | 'dark') => {\r\n        document.body.classList.remove('theme-light', 'theme-dark');\r\n        document.body.classList.add(`theme-${theme}`);\r\n        localStorage.setItem('cc_theme', theme);\r\n    };\r\n\r\n    // Identity-only rehydration from localStorage\r\n    useEffect(() => {\r\n        try {\r\n            const storedUser = localStorage.getItem('auth_user');\r\n            const storedToken = localStorage.getItem('auth_token');\r\n            if (storedUser) {\r\n                const parsed = JSON.parse(storedUser);\r\n                set_user(parsed);\r\n                set_role(parsed.role || null);\r\n            }\r\n            if (storedToken) {\r\n                set_token(storedToken);\r\n            }\r\n        } catch {\r\n            // Ignore corrupt storage\r\n        } finally {\r\n            set_loading(false);\r\n            if (typeof window !== 'undefined') {\r\n                (window as any).__AUTH_READY__ = true;\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    const sign_in = (user_data: User, token: string) => {\r\n        localStorage.setItem('auth_token', token);\r\n        localStorage.setItem('auth_user', JSON.stringify(user_data));\r\n        set_user(user_data);\r\n        set_token(token);\r\n        set_role(user_data.role || 'customer');\r\n\r\n        // Apply theme from user data on login\r\n        if (user_data.ui_preferences?.theme) {\r\n            apply_theme(user_data.ui_preferences.theme);\r\n        }\r\n    };\r\n\r\n    const update_theme = async (theme: 'light' | 'dark') => {\r\n        apply_theme(theme);\r\n        if (user) {\r\n            const updated_user = {\r\n                ...user,\r\n                ui_preferences: { ...user.ui_preferences, theme }\r\n            };\r\n            set_user(updated_user);\r\n            localStorage.setItem('auth_user', JSON.stringify(updated_user));\r\n        }\r\n    };\r\n\r\n    const sign_out = () => {\r\n        const userRole = role || (() => {\r\n            try {\r\n                const stored = localStorage.getItem('auth_user');\r\n                if (stored) {\r\n                    return JSON.parse(stored).role;\r\n                }\r\n            } catch { }\r\n            return null;\r\n        })();\r\n\r\n        localStorage.removeItem('auth_token');\r\n        localStorage.removeItem('auth_user');\r\n        set_user(null);\r\n        set_token(null);\r\n        set_role(null);\r\n\r\n        const { getLoginRedirectPath } = require('../utils/authRedirect.utils');\r\n        const redirectPath = getLoginRedirectPath(userRole);\r\n        window.location.href = redirectPath;\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                user,\r\n                token,\r\n                role,\r\n                is_authenticated: Boolean(user),\r\n                loading,\r\n                sign_in,\r\n                sign_out,\r\n                update_theme\r\n            }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport const useAuth = () => {\r\n    const ctx = useContext(AuthContext);\r\n    if (!ctx) throw new Error('useAuth must be used within AuthProvider');\r\n    return ctx;\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAEA;AAFA;;;AAqDA,MAAM,4BAAc,IAAA,oHAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAC9D,MAAM,CAAC,MAAM,SAAS,GAAG,IAAA,+GAAQ,EAAc;IAC/C,MAAM,CAAC,OAAO,UAAU,GAAG,IAAA,+GAAQ,EAAgB;IACnD,MAAM,CAAC,MAAM,SAAS,GAAG,IAAA,+GAAQ,EAAyC;IAC1E,MAAM,CAAC,SAAS,YAAY,GAAG,IAAA,+GAAQ,EAAC;IAExC,kCAAkC;IAClC,MAAM,cAAc,CAAC;QACjB,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,eAAe;QAC9C,SAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,OAAO;QAC5C,aAAa,OAAO,CAAC,YAAY;IACrC;IAEA,8CAA8C;IAC9C,IAAA,gHAAS,EAAC;QACN,IAAI;YACA,MAAM,aAAa,aAAa,OAAO,CAAC;YACxC,MAAM,cAAc,aAAa,OAAO,CAAC;YACzC,IAAI,YAAY;gBACZ,MAAM,SAAS,KAAK,KAAK,CAAC;gBAC1B,SAAS;gBACT,SAAS,OAAO,IAAI,IAAI;YAC5B;YACA,IAAI,aAAa;gBACb,UAAU;YACd;QACJ,EAAE,OAAM;QACJ,yBAAyB;QAC7B,SAAU;YACN,YAAY;YACZ;;QAGJ;IACJ,GAAG,EAAE;IAEL,MAAM,UAAU,CAAC,WAAiB;QAC9B,aAAa,OAAO,CAAC,cAAc;QACnC,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;QACjD,SAAS;QACT,UAAU;QACV,SAAS,UAAU,IAAI,IAAI;QAE3B,sCAAsC;QACtC,IAAI,UAAU,cAAc,EAAE,OAAO;YACjC,YAAY,UAAU,cAAc,CAAC,KAAK;QAC9C;IACJ;IAEA,MAAM,eAAe,OAAO;QACxB,YAAY;QACZ,IAAI,MAAM;YACN,MAAM,eAAe;gBACjB,GAAG,IAAI;gBACP,gBAAgB;oBAAE,GAAG,KAAK,cAAc;oBAAE;gBAAM;YACpD;YACA,SAAS;YACT,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;QACrD;IACJ;IAEA,MAAM,WAAW;QACb,MAAM,WAAW,QAAQ,CAAC;YACtB,IAAI;gBACA,MAAM,SAAS,aAAa,OAAO,CAAC;gBACpC,IAAI,QAAQ;oBACR,OAAO,KAAK,KAAK,CAAC,QAAQ,IAAI;gBAClC;YACJ,EAAE,OAAM,CAAE;YACV,OAAO;QACX,CAAC;QAED,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,SAAS;QACT,UAAU;QACV,SAAS;QAET,MAAM,EAAE,oBAAoB,EAAE;QAC9B,MAAM,eAAe,qBAAqB;QAC1C,OAAO,QAAQ,CAAC,IAAI,GAAG;IAC3B;IAEA,qBACI,qKAAC,YAAY,QAAQ;QACjB,OAAO;YACH;YACA;YACA;YACA,kBAAkB,QAAQ;YAC1B;YACA;YACA;YACA;QACJ;kBAEC;;;;;;AAGb;AAEO,MAAM,UAAU;IACnB,MAAM,MAAM,IAAA,iHAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACX"}},
    {"offset": {"line": 408, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/components/layout/DashboardLayout.tsx"],"sourcesContent":["import Link from 'next/link';\r\nimport { useRouter } from 'next/router';\r\nimport { useEffect, useState } from 'react';\r\nimport { api, setAuthToken } from '../../services/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\ntype Role = 'admin' | 'vendor';\r\n\r\ninterface DashboardLayoutProps {\r\n  role: Role;\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst itemsByRole: Record<Role, Array<{ label: string; href: string }>> = {\r\n  admin: [\r\n    { label: 'Dashboard Overview', href: '/admin/dashboard' },\r\n    { label: 'Vendors', href: '/admin/vendors' },\r\n    { label: 'Products', href: '/admin/products' },\r\n    { label: 'Orders', href: '/admin/orders' },\r\n    { label: 'Reports', href: '/admin/reports' },\r\n    { label: 'Customers', href: '/admin/customers' },\r\n    { label: 'Platform Settings', href: '/admin/settings' },\r\n  ],\r\n  vendor: [\r\n    { label: 'Dashboard Overview', href: '/vendor/dashboard' },\r\n    { label: 'Products', href: '/vendor/products' },\r\n    { label: 'Orders Live', href: '/vendor/orders' },\r\n    { label: 'Order History', href: '/vendor/ordershistory' },\r\n    { label: 'Product Sales', href: '/vendor/product-sales' },\r\n    { label: 'Earnings', href: '/vendor/earnings' },\r\n    { label: 'Inventory', href: '/vendor/inventory' },\r\n  ],\r\n};\r\n\r\nexport default function DashboardLayout({ role, children }: DashboardLayoutProps) {\r\n  const router = useRouter();\r\n  const { is_authenticated, loading, role: userRole, sign_out, user } = useAuth();\r\n  const items = itemsByRole[role];\r\n  const [userName, setUserName] = useState<string>('');\r\n  const [userEmail, setUserEmail] = useState<string>('');\r\n  const [isDark, setIsDark] = useState<boolean>(false);\r\n  const [avatarUrl, setAvatarUrl] = useState<string>('');\r\n\r\n  // AUTH GUARD: Enforce authentication and role matching\r\n  useEffect(() => {\r\n    if (!loading) {\r\n      if (!is_authenticated) {\r\n        router.replace('/login');\r\n        return;\r\n      }\r\n      if (userRole && userRole !== role) {\r\n        console.warn(`Role mismatch: expected ${role}, got ${userRole}`);\r\n        sign_out();\r\n        return;\r\n      }\r\n    }\r\n  }, [is_authenticated, loading, userRole, role, router, sign_out]);\r\n\r\n  useEffect(() => {\r\n    // Read from localStorage if available (set during login)\r\n    if (typeof window !== 'undefined') {\r\n      try {\r\n        // Read from auth_user (set by login page)\r\n        const stored = localStorage.getItem('auth_user');\r\n        if (stored) {\r\n          const parsed = JSON.parse(stored);\r\n          if (parsed?.name) setUserName(parsed.name);\r\n          if (parsed?.email) setUserEmail(parsed.email);\r\n        }\r\n      } catch { }\r\n\r\n      // Load theme preference\r\n      const theme = localStorage.getItem('cc_theme');\r\n      const prefersDark = theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches);\r\n      setIsDark(prefersDark);\r\n      if (prefersDark) {\r\n        document.body.classList.add('theme-dark');\r\n      } else {\r\n        document.body.classList.remove('theme-dark');\r\n      }\r\n      // Load vendor avatar if role is vendor\r\n      try {\r\n        if (role === 'vendor' && userRole === 'vendor' && user?.id) {\r\n          api.vendors.getById(user.id).then((data: any) => {\r\n            const url = data?.media?.logoUrl || '';\r\n            if (url) setAvatarUrl(url);\r\n          }).catch(() => { });\r\n        }\r\n      } catch { }\r\n    }\r\n  }, []);\r\n\r\n  const toggleTheme = () => {\r\n    const newTheme = !isDark;\r\n    setIsDark(newTheme);\r\n    if (newTheme) {\r\n      document.body.classList.add('theme-dark');\r\n      localStorage.setItem('cc_theme', 'dark');\r\n    } else {\r\n      document.body.classList.remove('theme-dark');\r\n      localStorage.setItem('cc_theme', 'light');\r\n    }\r\n  };\r\n\r\n  // LOADING STATE: Block render until auth is verified\r\n  if (loading) {\r\n    return (\r\n      <div style={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        height: '100vh',\r\n        fontFamily: 'sans-serif'\r\n      }}>\r\n        <p>Verifying session...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // RENDER PROTECTION: Don't render if not authenticated\r\n  if (!is_authenticated) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"dash-layout\">\r\n      <aside className=\"dash-sidebar\">\r\n        <div className=\"dash-brand\">Community Cart</div>\r\n        <nav className=\"dash-nav\">\r\n          <ul className=\"dash-nav-list\">\r\n            {items.map((item) => {\r\n              // Exact match for most routes; keep /vendor/orders distinct from /vendor/ordershistory\r\n              let active = router.pathname === item.href;\r\n              if (item.href === '/vendor/orders' && router.pathname.startsWith('/vendor/orders/')) {\r\n                active = false; // Keep history route from marking live orders as active\r\n              }\r\n              return (\r\n                <li key={item.href} className={`dash-nav-item ${active ? 'active' : ''}`}>\r\n                  <Link href={item.href} className=\"dash-nav-link\">\r\n                    <span className=\"dash-icon\" aria-hidden>▣</span>\r\n                    <span className=\"dash-label\">{item.label}</span>\r\n                  </Link>\r\n                </li>\r\n              );\r\n            })}\r\n          </ul>\r\n        </nav>\r\n        <div className=\"dash-sidebar-bottom\">\r\n          <Link href=\"/vendor/profile\" className=\"dash-profile\" title=\"View Profile\">\r\n            <div className=\"dash-profile-avatar\" aria-hidden>\r\n              {avatarUrl ? (\r\n                <img src={avatarUrl} alt=\"Profile\" />\r\n              ) : (\r\n                (userName || 'U').trim().charAt(0).toUpperCase()\r\n              )}\r\n            </div>\r\n            <div className=\"dash-profile-text\">\r\n              <div className=\"dash-profile-name\">{userName || 'User'}</div>\r\n              <div className=\"dash-profile-email\">{userEmail || '—'}</div>\r\n            </div>\r\n          </Link>\r\n          <button\r\n            className=\"dash-theme-btn\"\r\n            onClick={toggleTheme}\r\n            title={isDark ? 'Switch to Light Mode' : 'Switch to Dark Mode'}\r\n          >\r\n            {isDark ? 'Light' : 'Dark'}\r\n          </button>\r\n          <button\r\n            className=\"dash-logout-btn\"\r\n            onClick={() => {\r\n              sign_out();\r\n            }}\r\n          >\r\n            Logout\r\n          </button>\r\n        </div>\r\n      </aside>\r\n      <main className=\"dash-main\" role=\"main\">\r\n        {children}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 735, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/components/ui/Toast.tsx"],"sourcesContent":["import { useEffect } from 'react';\r\n\r\ninterface ToastProps {\r\n    id: string;\r\n    message: string;\r\n    type: 'warning' | 'info' | 'error' | 'success';\r\n    onDismiss: (id: string) => void;\r\n}\r\n\r\nexport default function Toast({ id, message, type, onDismiss }: ToastProps) {\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            onDismiss(id);\r\n        }, 5000);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [id, onDismiss]);\r\n\r\n    const getIcon = () => {\r\n        switch (type) {\r\n            case 'warning':\r\n                return (\r\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM11 15H9V13H11V15ZM11 11H9V5H11V11Z\" fill=\"#F59E0B\" />\r\n                    </svg>\r\n                );\r\n            case 'error':\r\n                return (\r\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM11 15H9V13H11V15ZM11 11H9V5H11V11Z\" fill=\"#EF4444\" />\r\n                    </svg>\r\n                );\r\n            case 'success':\r\n                return (\r\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM8 15L3 10L4.41 8.59L8 12.17L15.59 4.58L17 6L8 15Z\" fill=\"#10B981\" />\r\n                    </svg>\r\n                );\r\n            case 'info':\r\n            default:\r\n                return (\r\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM11 15H9V9H11V15ZM11 7H9V5H11V7Z\" fill=\"#3B82F6\" />\r\n                    </svg>\r\n                );\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`toast toast-${type}`}>\r\n            <div className=\"toast-icon\">{getIcon()}</div>\r\n            <div className=\"toast-message\">{message}</div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AASe,SAAS,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAc;IACtE,IAAA,gHAAS,EAAC;QACN,MAAM,QAAQ,WAAW;YACrB,UAAU;QACd,GAAG;QAEH,OAAO,IAAM,aAAa;IAC9B,GAAG;QAAC;QAAI;KAAU;IAElB,MAAM,UAAU;QACZ,OAAQ;YACJ,KAAK;gBACD,qBACI,qKAAC;oBAAI,OAAM;oBAAK,QAAO;oBAAK,SAAQ;oBAAY,MAAK;oBAAO,OAAM;8BAC9D,cAAA,qKAAC;wBAAK,GAAE;wBAAkI,MAAK;;;;;;;;;;;YAG3J,KAAK;gBACD,qBACI,qKAAC;oBAAI,OAAM;oBAAK,QAAO;oBAAK,SAAQ;oBAAY,MAAK;oBAAO,OAAM;8BAC9D,cAAA,qKAAC;wBAAK,GAAE;wBAAkI,MAAK;;;;;;;;;;;YAG3J,KAAK;gBACD,qBACI,qKAAC;oBAAI,OAAM;oBAAK,QAAO;oBAAK,SAAQ;oBAAY,MAAK;oBAAO,OAAM;8BAC9D,cAAA,qKAAC;wBAAK,GAAE;wBAAiJ,MAAK;;;;;;;;;;;YAG1K,KAAK;YACL;gBACI,qBACI,qKAAC;oBAAI,OAAM;oBAAK,QAAO;oBAAK,SAAQ;oBAAY,MAAK;oBAAO,OAAM;8BAC9D,cAAA,qKAAC;wBAAK,GAAE;wBAA+H,MAAK;;;;;;;;;;;QAG5J;IACJ;IAEA,qBACI,qKAAC;QAAI,WAAW,CAAC,YAAY,EAAE,MAAM;;0BACjC,qKAAC;gBAAI,WAAU;0BAAc;;;;;;0BAC7B,qKAAC;gBAAI,WAAU;0BAAiB;;;;;;;;;;;;AAG5C"}},
    {"offset": {"line": 868, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/components/ui/ToastProvider.tsx"],"sourcesContent":["import React, { createContext, useCallback, useContext, useMemo, useState } from 'react';\r\nimport Toast from './Toast';\r\n\r\nexport type ToastType = 'success' | 'error' | 'info' | 'warning';\r\n\r\nexport interface ToastItem {\r\n  id: string;\r\n  type: ToastType;\r\n  message: string;\r\n  timestamp: number;\r\n}\r\n\r\ninterface ToastContextValue {\r\n  queue: ToastItem[];\r\n  enqueueToast: (message: string, type?: ToastType) => void;\r\n  dismissToast: (id: string) => void;\r\n  // Legacy compatibility\r\n  showToast: (message: string, type?: ToastType) => void;\r\n  pushToast: (toast: { message: string; type?: ToastType }) => void;\r\n}\r\n\r\nconst ToastContext = createContext<ToastContextValue | undefined>(undefined);\r\n\r\nexport const useToast = () => {\r\n  const ctx = useContext(ToastContext);\r\n  if (!ctx) throw new Error('useToast must be used within ToastProvider');\r\n  return ctx;\r\n};\r\n\r\nexport const ToastProvider: React.FC<React.PropsWithChildren<{}>> = ({ children }) => {\r\n  const [queue, setQueue] = useState<ToastItem[]>([]);\r\n\r\n  const enqueueToast = useCallback((message: string, type: ToastType = 'info') => {\r\n    const newToast: ToastItem = {\r\n      id: `toast-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      message,\r\n      type,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    setQueue((prevQueue) => [...prevQueue, newToast]);\r\n  }, []);\r\n\r\n  // Listen for 'cc-backend-offline' event from non-React utilities (customerFetch)\r\n  React.useEffect(() => {\r\n    const handleOffline = () => {\r\n      enqueueToast('Backend not connected. Retrying...', 'error');\r\n    };\r\n    window.addEventListener('cc-backend-offline', handleOffline);\r\n    return () => window.removeEventListener('cc-backend-offline', handleOffline);\r\n  }, [enqueueToast]);\r\n\r\n  const dismissToast = useCallback((id: string) => {\r\n    setQueue((prevQueue) => prevQueue.filter((toast) => toast.id !== id));\r\n  }, []);\r\n\r\n  // Legacy compatibility methods\r\n  const showToast = useCallback((message: string, type: ToastType = 'info') => {\r\n    enqueueToast(message, type);\r\n  }, [enqueueToast]);\r\n\r\n  const pushToast = useCallback((toast: { message: string; type?: ToastType }) => {\r\n    enqueueToast(toast.message, toast.type);\r\n  }, [enqueueToast]);\r\n\r\n  const value = useMemo(() => ({\r\n    queue,\r\n    enqueueToast,\r\n    dismissToast,\r\n    showToast,\r\n    pushToast\r\n  }), [queue, enqueueToast, dismissToast, showToast, pushToast]);\r\n\r\n  // Only render the first 2 toasts (2-toast limit)\r\n  const visibleToasts = queue.slice(0, 2);\r\n\r\n  return (\r\n    <ToastContext.Provider value={value}>\r\n      {children}\r\n      {visibleToasts.length > 0 && (\r\n        <div className=\"toast-container\" aria-live=\"polite\" aria-atomic=\"true\">\r\n          {visibleToasts.map((toast) => (\r\n            <Toast\r\n              key={toast.id}\r\n              id={toast.id}\r\n              message={toast.message}\r\n              type={toast.type}\r\n              onDismiss={dismissToast}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </ToastContext.Provider>\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;;;;AAoBA,MAAM,6BAAe,IAAA,oHAAa,EAAgC;AAE3D,MAAM,WAAW;IACtB,MAAM,MAAM,IAAA,iHAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;AAEO,MAAM,gBAAuD,CAAC,EAAE,QAAQ,EAAE;IAC/E,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+GAAQ,EAAc,EAAE;IAElD,MAAM,eAAe,IAAA,kHAAW,EAAC,CAAC,SAAiB,OAAkB,MAAM;QACzE,MAAM,WAAsB;YAC1B,IAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;YACpE;YACA;YACA,WAAW,KAAK,GAAG;QACrB;QAEA,SAAS,CAAC,YAAc;mBAAI;gBAAW;aAAS;IAClD,GAAG,EAAE;IAEL,iFAAiF;IACjF,8GAAK,CAAC,SAAS,CAAC;QACd,MAAM,gBAAgB;YACpB,aAAa,sCAAsC;QACrD;QACA,OAAO,gBAAgB,CAAC,sBAAsB;QAC9C,OAAO,IAAM,OAAO,mBAAmB,CAAC,sBAAsB;IAChE,GAAG;QAAC;KAAa;IAEjB,MAAM,eAAe,IAAA,kHAAW,EAAC,CAAC;QAChC,SAAS,CAAC,YAAc,UAAU,MAAM,CAAC,CAAC,QAAU,MAAM,EAAE,KAAK;IACnE,GAAG,EAAE;IAEL,+BAA+B;IAC/B,MAAM,YAAY,IAAA,kHAAW,EAAC,CAAC,SAAiB,OAAkB,MAAM;QACtE,aAAa,SAAS;IACxB,GAAG;QAAC;KAAa;IAEjB,MAAM,YAAY,IAAA,kHAAW,EAAC,CAAC;QAC7B,aAAa,MAAM,OAAO,EAAE,MAAM,IAAI;IACxC,GAAG;QAAC;KAAa;IAEjB,MAAM,QAAQ,IAAA,8GAAO,EAAC,IAAM,CAAC;YAC3B;YACA;YACA;YACA;YACA;QACF,CAAC,GAAG;QAAC;QAAO;QAAc;QAAc;QAAW;KAAU;IAE7D,iDAAiD;IACjD,MAAM,gBAAgB,MAAM,KAAK,CAAC,GAAG;IAErC,qBACE,qKAAC,aAAa,QAAQ;QAAC,OAAO;;YAC3B;YACA,cAAc,MAAM,GAAG,mBACtB,qKAAC;gBAAI,WAAU;gBAAkB,aAAU;gBAAS,eAAY;0BAC7D,cAAc,GAAG,CAAC,CAAC,sBAClB,qKAAC,iLAAK;wBAEJ,IAAI,MAAM,EAAE;wBACZ,SAAS,MAAM,OAAO;wBACtB,MAAM,MAAM,IAAI;wBAChB,WAAW;uBAJN,MAAM,EAAE;;;;;;;;;;;;;;;;AAW3B"}},
    {"offset": {"line": 973, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/utils/customerFetch.ts"],"sourcesContent":["\r\n\r\n// Global flag to track if we've already shown the \"offline\" toast in this session/load.\r\nlet hasShownOfflineToast = false;\r\n\r\n// Custom error to silently suppress in Customer UI\r\nexport class SilentNetworkError extends Error {\r\n    constructor() {\r\n        super('SilentNetworkError');\r\n        this.name = 'SilentNetworkError';\r\n    }\r\n}\r\n\r\n/**\r\n * A wrapper around `fetch` for Customer UI that handles infinite loading on backend failure.\r\n * \r\n * Behavior on NETWORK ERROR (e.g. backend down):\r\n * 1. Dispatches 'cc-backend-offline' event (handled by ToastProvider).\r\n * 2. Returns a Promise that NEVER resolves. \r\n *    - This keeps `await customerFetch(...)` hanging.\r\n *    - React state remains `loading={true}`.\r\n *    - Skeletons stay visible indefinitely.\r\n * \r\n * Behavior on SUCCESS or valid HTTP response (even 4xx/5xx):\r\n * - Returns response normaly.\r\n */\r\nexport async function customerFetch(input: RequestInfo | URL, init?: RequestInit): Promise<Response> {\r\n    try {\r\n        const response = await fetch(input, init);\r\n        return response;\r\n    } catch (error: any) {\r\n        // Detect Network Error (Chrome often says \"Failed to fetch\")\r\n        if (error instanceof TypeError && error.message === 'Failed to fetch') {\r\n\r\n            // 1. Dispatch Custom Event (Listening in ToastProvider)\r\n            if (!hasShownOfflineToast) {\r\n                if (typeof window !== 'undefined') {\r\n                    window.dispatchEvent(new CustomEvent('cc-backend-offline'));\r\n                }\r\n                hasShownOfflineToast = true;\r\n            }\r\n\r\n            // 2. Suppress Console Noise\r\n            // We do NOT log this error to console.error to keep it clean.\r\n\r\n            // 3. Infinite Loading Magic\r\n            // Return a promise that never resolves.\r\n            return new Promise(() => {\r\n                // Intentionally empty.\r\n                // Caller (e.g., await customerFetch()) will hang here forever.\r\n                // Loading spinners/skeletons will persist.\r\n            });\r\n        }\r\n\r\n        // Re-throw other unexpected errors (extensions interfering, etc.)\r\n        throw error;\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAEA,wFAAwF;;;;;;;AACxF,IAAI,uBAAuB;AAGpB,MAAM,2BAA2B;IACpC,aAAc;QACV,KAAK,CAAC;QACN,IAAI,CAAC,IAAI,GAAG;IAChB;AACJ;AAeO,eAAe,cAAc,KAAwB,EAAE,IAAkB;IAC5E,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,OAAO;QACpC,OAAO;IACX,EAAE,OAAO,OAAY;QACjB,6DAA6D;QAC7D,IAAI,iBAAiB,aAAa,MAAM,OAAO,KAAK,mBAAmB;YAEnE,wDAAwD;YACxD,IAAI,CAAC,sBAAsB;gBACvB;;gBAGA,uBAAuB;YAC3B;YAEA,4BAA4B;YAC5B,8DAA8D;YAE9D,4BAA4B;YAC5B,wCAAwC;YACxC,OAAO,IAAI,QAAQ;YACf,uBAAuB;YACvB,+DAA+D;YAC/D,2CAA2C;YAC/C;QACJ;QAEA,kEAAkE;QAClE,MAAM;IACV;AACJ"}},
    {"offset": {"line": 1018, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/context/CustomerStore.tsx"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from 'react';\r\n\r\n// --- Interfaces ---\r\nexport interface ProductLite {\r\n  _id: string;\r\n  name: string;\r\n  price: number;\r\n  vendorName?: string;\r\n  image?: string;\r\n  stock?: number;\r\n  category?: string; // Important for consistency\r\n}\r\n\r\nexport interface CartItem {\r\n  product: ProductLite;\r\n  quantity: number;\r\n}\r\n\r\ninterface CustomerStoreState {\r\n  customerId: string | null;\r\n  cart: CartItem[];\r\n  ensureCustomerId: () => Promise<string | null>;\r\n  addToCart: (product: ProductLite, maxStock?: number, quantity?: number) => void;\r\n  updateQuantity: (productId: string, quantity: number) => void;\r\n  removeFromCart: (productId: string) => void;\r\n  clearCart: () => void;\r\n  totalPrice: number;\r\n  totalItems: number;\r\n  validateCart: () => Promise<void>;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst CustomerStoreContext = createContext<CustomerStoreState | undefined>(undefined);\r\n\r\nconst API_BASE = 'http://localhost:5000/api';\r\nconst STORAGE_CART_KEY = 'cc_customer_cart_v2'; // New key to avoid conflicts\r\nconst STORAGE_CUSTOMER_KEY = 'cc_customer_id';\r\n\r\nimport { useAuth } from './AuthContext';\r\n\r\n// ... imports\r\nimport { customerFetch } from '../utils/customerFetch';\r\n\r\nexport function CustomerStoreProvider({ children }: { children: React.ReactNode }) {\r\n  const { token, is_authenticated } = useAuth();\r\n  const [cart, setCart] = useState<CartItem[]>([]);\r\n  const [customerId, setCustomerId] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Helper to get token safely (prefer context, fallback to local)\r\n  const getToken = () => {\r\n    return token || (typeof window !== 'undefined' ? localStorage.getItem('auth_token') : null);\r\n  };\r\n\r\n  // --- FETCH CART (Server or Local) ---\r\n  const fetchCart = async () => {\r\n    const activeToken = getToken();\r\n\r\n    if (activeToken) {\r\n      // LOGGED IN: Server Source of Truth\r\n      try {\r\n        setIsLoading(true);\r\n        const res = await customerFetch(`${API_BASE}/cart`, {\r\n          headers: { 'Authorization': `Bearer ${activeToken}` }\r\n        });\r\n\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          setCart(data.cart || []);\r\n          // ... rest of logic\r\n          if (data.removedItems?.length > 0) {\r\n            console.warn('Items removed by server:', data.removedItems);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error('Failed to fetch server cart', err);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    } else {\r\n      // GUEST: Local Storage\r\n      const local = localStorage.getItem(STORAGE_CART_KEY);\r\n      if (local) {\r\n        try {\r\n          setCart(JSON.parse(local));\r\n        } catch {\r\n          setCart([]);\r\n        }\r\n      } else {\r\n        setCart([]); // Clear cart if no local data\r\n      }\r\n    }\r\n  };\r\n\r\n  // Refetch when auth state changes\r\n  useEffect(() => {\r\n    fetchCart();\r\n\r\n    // Also load customer ID if needed for legacy logic\r\n    const savedCid = typeof window !== 'undefined' ? localStorage.getItem(STORAGE_CUSTOMER_KEY) : null;\r\n    if (savedCid) setCustomerId(savedCid);\r\n  }, [token, is_authenticated]); // Re-run on login/logout\r\n\r\n  // Save to LocalStorage ONLY if Guest (backup)\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const token = getToken();\r\n    if (!token) {\r\n      localStorage.setItem(STORAGE_CART_KEY, JSON.stringify(cart));\r\n    }\r\n  }, [cart]);\r\n\r\n\r\n  // --- ACTIONS ---\r\n\r\n  const addToCart = async (product: ProductLite, maxStock?: number, quantity: number = 1) => {\r\n    const token = getToken();\r\n\r\n    // 1. Optimistic Update (for speed)\r\n    const prevCart = [...cart];\r\n    // ... insert optimistic logic here if desired, OR just wait for server for stability.\r\n    // User requested \"Stability\", so let's Wait for Server. simpler.\r\n\r\n    setIsLoading(true);\r\n\r\n    if (token) {\r\n      // SERVER ADD\r\n      try {\r\n        const res = await customerFetch(`${API_BASE}/cart/add`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}`\r\n          },\r\n          body: JSON.stringify({\r\n            productId: product._id,\r\n            quantity: quantity\r\n          })\r\n        });\r\n\r\n        if (res.ok) {\r\n          await fetchCart(); // Re-sync truth\r\n        } else {\r\n          const err = await res.json();\r\n          alert(err.message || 'Could not add to cart');\r\n        }\r\n      } catch (err) {\r\n        alert('ErrorMessage: Network error adding to cart');\r\n      }\r\n    } else {\r\n      // LOCAL ADD\r\n      // Simple local logic\r\n      setCart(prev => {\r\n        const existing = prev.find(i => i.product._id === product._id);\r\n        // Simplified stock check for guest\r\n        if (existing) {\r\n          return prev.map(i => i.product._id === product._id ? { ...i, quantity: i.quantity + quantity } : i);\r\n        }\r\n        return [...prev, { product, quantity: quantity }];\r\n      });\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const updateQuantity = async (productId: string, quantity: number) => {\r\n    if (quantity < 1) return; // Use remove instead\r\n    const token = getToken();\r\n    setIsLoading(true);\r\n\r\n    if (token) {\r\n      // SERVER UPDATE\r\n      try {\r\n        const res = await customerFetch(`${API_BASE}/cart/${productId}`, {\r\n          method: 'PATCH',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}`\r\n          },\r\n          body: JSON.stringify({ quantity })\r\n        });\r\n\r\n        if (res.ok) {\r\n          await fetchCart();\r\n        } else {\r\n          const err = await res.json();\r\n          alert(err.message);\r\n        }\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    } else {\r\n      // LOCAL UPDATE\r\n      setCart(prev => prev.map(i => i.product._id === productId ? { ...i, quantity } : i));\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const removeFromCart = async (productId: string) => {\r\n    const token = getToken();\r\n    setIsLoading(true);\r\n\r\n    if (token) {\r\n      // SERVER REMOVE\r\n      try {\r\n        await customerFetch(`${API_BASE}/cart/${productId}`, {\r\n          method: 'DELETE',\r\n          headers: { 'Authorization': `Bearer ${token}` }\r\n        });\r\n        await fetchCart();\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    } else {\r\n      // LOCAL REMOVE\r\n      setCart(prev => prev.filter(i => i.product._id !== productId));\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const clearCart = async () => {\r\n    const token = getToken();\r\n    if (token) {\r\n      await customerFetch(`${API_BASE}/cart`, {\r\n        method: 'DELETE',\r\n        headers: { 'Authorization': `Bearer ${token}` }\r\n      });\r\n      setCart([]);\r\n    } else {\r\n      setCart([]);\r\n    }\r\n  };\r\n\r\n  const validateCart = async () => {\r\n    await fetchCart(); // Re-fetching essentially validates\r\n  };\r\n\r\n  const ensureCustomerId = async (): Promise<string | null> => {\r\n    return customerId;\r\n  };\r\n\r\n  // --- DERIVED STATE ---\r\n  const totalPrice = useMemo(\r\n    () => cart.reduce((sum, item) => sum + item.product.price * item.quantity, 0),\r\n    [cart]\r\n  );\r\n\r\n  const totalItems = useMemo(\r\n    () => cart.reduce((sum, item) => sum + item.quantity, 0),\r\n    [cart]\r\n  );\r\n\r\n  const value: CustomerStoreState = {\r\n    customerId,\r\n    cart,\r\n    ensureCustomerId,\r\n    addToCart,\r\n    updateQuantity,\r\n    removeFromCart,\r\n    clearCart,\r\n    totalPrice,\r\n    totalItems,\r\n    validateCart,\r\n    isLoading\r\n  };\r\n\r\n  return <CustomerStoreContext.Provider value={value}>{children}</CustomerStoreContext.Provider>;\r\n}\r\n\r\nexport const useCustomerStore = () => {\r\n  const ctx = useContext(CustomerStoreContext);\r\n  if (!ctx) throw new Error('useCustomerStore must be used within CustomerStoreProvider');\r\n  return ctx;\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAAA;AAsCA;AAEA,cAAc;AACd;;;AATA,MAAM,qCAAuB,IAAA,oHAAa,EAAiC;AAE3E,MAAM,WAAW;AACjB,MAAM,mBAAmB,uBAAuB,6BAA6B;AAC7E,MAAM,uBAAuB;;;AAOtB,SAAS,sBAAsB,EAAE,QAAQ,EAAiC;IAC/E,MAAM,EAAE,KAAK,EAAE,gBAAgB,EAAE,GAAG,IAAA,8KAAO;IAC3C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAa,EAAE;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAAgB;IAC5D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+GAAQ,EAAC;IAE3C,iEAAiE;IACjE,MAAM,WAAW;QACf,OAAO,SAAS,CAAC,sCAAgC,0BAAqC,IAAI;IAC5F;IAEA,uCAAuC;IACvC,MAAM,YAAY;QAChB,MAAM,cAAc;QAEpB,IAAI,aAAa;YACf,oCAAoC;YACpC,IAAI;gBACF,aAAa;gBACb,MAAM,MAAM,MAAM,IAAA,mLAAa,EAAC,GAAG,SAAS,KAAK,CAAC,EAAE;oBAClD,SAAS;wBAAE,iBAAiB,CAAC,OAAO,EAAE,aAAa;oBAAC;gBACtD;gBAEA,IAAI,IAAI,EAAE,EAAE;oBACV,MAAM,OAAO,MAAM,IAAI,IAAI;oBAC3B,QAAQ,KAAK,IAAI,IAAI,EAAE;oBACvB,oBAAoB;oBACpB,IAAI,KAAK,YAAY,EAAE,SAAS,GAAG;wBACjC,QAAQ,IAAI,CAAC,4BAA4B,KAAK,YAAY;oBAC5D;gBACF;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,+BAA+B;YAC/C,SAAU;gBACR,aAAa;YACf;QACF,OAAO;YACL,uBAAuB;YACvB,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,OAAO;gBACT,IAAI;oBACF,QAAQ,KAAK,KAAK,CAAC;gBACrB,EAAE,OAAM;oBACN,QAAQ,EAAE;gBACZ;YACF,OAAO;gBACL,QAAQ,EAAE,GAAG,8BAA8B;YAC7C;QACF;IACF;IAEA,kCAAkC;IAClC,IAAA,gHAAS,EAAC;QACR;QAEA,mDAAmD;QACnD,MAAM,WAAW,sCAAgC,0BAA6C;QAC9F;;IACF,GAAG;QAAC;QAAO;KAAiB,GAAG,yBAAyB;IAExD,8CAA8C;IAC9C,IAAA,gHAAS,EAAC;QACR,wCAAmC;;;QACnC,MAAM;IAIR,GAAG;QAAC;KAAK;IAGT,kBAAkB;IAElB,MAAM,YAAY,OAAO,SAAsB,UAAmB,WAAmB,CAAC;QACpF,MAAM,QAAQ;QAEd,mCAAmC;QACnC,MAAM,WAAW;eAAI;SAAK;QAC1B,sFAAsF;QACtF,iEAAiE;QAEjE,aAAa;QAEb,IAAI,OAAO;YACT,aAAa;YACb,IAAI;gBACF,MAAM,MAAM,MAAM,IAAA,mLAAa,EAAC,GAAG,SAAS,SAAS,CAAC,EAAE;oBACtD,QAAQ;oBACR,SAAS;wBACP,gBAAgB;wBAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;oBACpC;oBACA,MAAM,KAAK,SAAS,CAAC;wBACnB,WAAW,QAAQ,GAAG;wBACtB,UAAU;oBACZ;gBACF;gBAEA,IAAI,IAAI,EAAE,EAAE;oBACV,MAAM,aAAa,gBAAgB;gBACrC,OAAO;oBACL,MAAM,MAAM,MAAM,IAAI,IAAI;oBAC1B,MAAM,IAAI,OAAO,IAAI;gBACvB;YACF,EAAE,OAAO,KAAK;gBACZ,MAAM;YACR;QACF,OAAO;YACL,YAAY;YACZ,qBAAqB;YACrB,QAAQ,CAAA;gBACN,MAAM,WAAW,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,OAAO,CAAC,GAAG,KAAK,QAAQ,GAAG;gBAC7D,mCAAmC;gBACnC,IAAI,UAAU;oBACZ,OAAO,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,OAAO,CAAC,GAAG,KAAK,QAAQ,GAAG,GAAG;4BAAE,GAAG,CAAC;4BAAE,UAAU,EAAE,QAAQ,GAAG;wBAAS,IAAI;gBACnG;gBACA,OAAO;uBAAI;oBAAM;wBAAE;wBAAS,UAAU;oBAAS;iBAAE;YACnD;QACF;QACA,aAAa;IACf;IAEA,MAAM,iBAAiB,OAAO,WAAmB;QAC/C,IAAI,WAAW,GAAG,QAAQ,qBAAqB;QAC/C,MAAM,QAAQ;QACd,aAAa;QAEb,IAAI,OAAO;YACT,gBAAgB;YAChB,IAAI;gBACF,MAAM,MAAM,MAAM,IAAA,mLAAa,EAAC,GAAG,SAAS,MAAM,EAAE,WAAW,EAAE;oBAC/D,QAAQ;oBACR,SAAS;wBACP,gBAAgB;wBAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;oBACpC;oBACA,MAAM,KAAK,SAAS,CAAC;wBAAE;oBAAS;gBAClC;gBAEA,IAAI,IAAI,EAAE,EAAE;oBACV,MAAM;gBACR,OAAO;oBACL,MAAM,MAAM,MAAM,IAAI,IAAI;oBAC1B,MAAM,IAAI,OAAO;gBACnB;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC;YAChB;QACF,OAAO;YACL,eAAe;YACf,QAAQ,CAAA,OAAQ,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,OAAO,CAAC,GAAG,KAAK,YAAY;wBAAE,GAAG,CAAC;wBAAE;oBAAS,IAAI;QACnF;QACA,aAAa;IACf;IAEA,MAAM,iBAAiB,OAAO;QAC5B,MAAM,QAAQ;QACd,aAAa;QAEb,IAAI,OAAO;YACT,gBAAgB;YAChB,IAAI;gBACF,MAAM,IAAA,mLAAa,EAAC,GAAG,SAAS,MAAM,EAAE,WAAW,EAAE;oBACnD,QAAQ;oBACR,SAAS;wBAAE,iBAAiB,CAAC,OAAO,EAAE,OAAO;oBAAC;gBAChD;gBACA,MAAM;YACR,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC;YAChB;QACF,OAAO;YACL,eAAe;YACf,QAAQ,CAAA,OAAQ,KAAK,MAAM,CAAC,CAAA,IAAK,EAAE,OAAO,CAAC,GAAG,KAAK;QACrD;QACA,aAAa;IACf;IAEA,MAAM,YAAY;QAChB,MAAM,QAAQ;QACd,IAAI,OAAO;YACT,MAAM,IAAA,mLAAa,EAAC,GAAG,SAAS,KAAK,CAAC,EAAE;gBACtC,QAAQ;gBACR,SAAS;oBAAE,iBAAiB,CAAC,OAAO,EAAE,OAAO;gBAAC;YAChD;YACA,QAAQ,EAAE;QACZ,OAAO;YACL,QAAQ,EAAE;QACZ;IACF;IAEA,MAAM,eAAe;QACnB,MAAM,aAAa,oCAAoC;IACzD;IAEA,MAAM,mBAAmB;QACvB,OAAO;IACT;IAEA,wBAAwB;IACxB,MAAM,aAAa,IAAA,8GAAO,EACxB,IAAM,KAAK,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,OAAO,CAAC,KAAK,GAAG,KAAK,QAAQ,EAAE,IAC3E;QAAC;KAAK;IAGR,MAAM,aAAa,IAAA,8GAAO,EACxB,IAAM,KAAK,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,QAAQ,EAAE,IACtD;QAAC;KAAK;IAGR,MAAM,QAA4B;QAChC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;IAEA,qBAAO,qKAAC,qBAAqB,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AACvD;AAEO,MAAM,mBAAmB;IAC9B,MAAM,MAAM,IAAA,iHAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT"}},
    {"offset": {"line": 1276, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/_app.tsx"],"sourcesContent":["import '../styles/globals.css';\r\nimport '../styles/customer_global.css';\r\nimport '../styles/filters_styling.css';\r\nimport '../components/layout/DashboardLayout.css';\r\nimport './login.css';\r\nimport './admin/dashboard.css';\r\nimport './admin/vendors.css';\r\nimport './admin/products.css';\r\nimport './admin/orders.css';\r\nimport './admin/customers.css';\r\nimport './admin/vendor-edit.css';\r\nimport './vendor/dashboard.css';\r\nimport './vendor/products.css';\r\nimport './vendor/orders.css';\r\nimport './vendor/ordershistory.css';\r\nimport './vendor/orderdetails.css';\r\nimport './vendor/product-sales.css';\r\nimport './vendor/profile.css';\r\nimport './customer/products.css';\r\nimport './customer/home.css';\r\n\r\nimport './customer/browse-products.css';\r\nimport './customer/cart.css';\r\nimport './customer/place-order.css';\r\nimport './customer/track-order.css';\r\nimport './customer/profile.css';\r\nimport './customer/apploading.css';\r\nimport './customer/signin.css';\r\nimport './customer/signup.css';\r\nimport './customer/forgot-password.css';\r\nimport './customer/verify-otp.css';\r\nimport './customer/reset-password.css';\r\nimport './customer/verify-mobile.css';\r\nimport './customer/category.css';\r\nimport './customer/orders.css';\r\nimport './customer/address.css';\r\nimport './customer/edit-address.css';\r\nimport './customer/favorites.css';\r\nimport './customer/bottom-navbar.css';\r\nimport './customer/checkout.css';\r\nimport './customer/product-detail.css';\r\nimport './customer/edit-profile.css';\r\nimport '../components/customer/CustomerLayout.css';\r\n\r\nimport '../styles/toast.css';\r\nimport type { ReactElement, ReactNode } from 'react';\r\nimport type { NextPage } from 'next';\r\nimport type { AppProps } from 'next/app';\r\nimport { useEffect } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport Script from 'next/script';\r\nimport DashboardLayout from '../components/layout/DashboardLayout';\r\nimport { ToastProvider } from '../components/ui/ToastProvider';\r\nimport { CustomerStoreProvider } from '../context/CustomerStore';\r\nimport { AuthProvider } from '../context/AuthContext';\r\n\r\n// Extend window interface for Google GIS flag\r\ndeclare global {\r\n  interface Window {\r\n    __GOOGLE_GIS_LOADED__?: boolean;\r\n    google?: any;\r\n  }\r\n}\r\n\r\nexport type NextPageWithLayout<P = {}, IP = P> = NextPage<P, IP> & {\r\n  getLayout?: (page: ReactElement) => ReactNode;\r\n};\r\n\r\ntype AppPropsWithLayout = AppProps & {\r\n  Component: NextPageWithLayout;\r\n};\r\n\r\nfunction MyApp({ Component, pageProps }: AppPropsWithLayout) {\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    // Initial Theme Load\r\n    const savedTheme = localStorage.getItem('cc_theme') || 'light';\r\n    document.body.classList.add(`theme-${savedTheme}`);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const selectors = [\r\n      '#__next-build-indicator',\r\n      '#__next-build-watcher',\r\n      '.nextjs-devtools-indicator',\r\n      '.nextjs-devtools-indicator-root',\r\n      '[data-nextjs-dev-indicator]'\r\n    ];\r\n\r\n    const removeIndicators = () => {\r\n      selectors.forEach((s) => {\r\n        document.querySelectorAll(s).forEach((el) => el.remove());\r\n      });\r\n    };\r\n\r\n    removeIndicators();\r\n\r\n    const observer = new MutationObserver(() => removeIndicators());\r\n    observer.observe(document.documentElement, { childList: true, subtree: true });\r\n    return () => observer.disconnect();\r\n  }, []);\r\n\r\n  // Global autofill suppression (opt-out on login page)\r\n  const disableAutofill = router.pathname !== '/login';\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const semanticNames = ['email', 'password', 'phone', 'username', 'name'];\r\n\r\n    const harden = () => {\r\n      const forms = Array.from(document.querySelectorAll('form')) as HTMLFormElement[];\r\n      const inputs = Array.from(document.querySelectorAll('input')) as HTMLInputElement[];\r\n\r\n      if (!disableAutofill) {\r\n        forms.forEach((form) => form.setAttribute('autocomplete', 'on'));\r\n        inputs.forEach((input) => {\r\n          const type = input.getAttribute('type') || '';\r\n          if (type === 'password') {\r\n            input.setAttribute('autocomplete', 'current-password');\r\n            input.removeAttribute('readonly');\r\n          }\r\n        });\r\n        return;\r\n      }\r\n\r\n      forms.forEach((form) => form.setAttribute('autocomplete', 'off'));\r\n\r\n      inputs.forEach((input, idx) => {\r\n        const type = (input.getAttribute('type') || '').toLowerCase();\r\n        input.setAttribute('autocomplete', 'off');\r\n\r\n        if (input.name && semanticNames.includes(input.name)) {\r\n          input.name = `cc_field_${idx}`;\r\n        }\r\n\r\n        if (type === 'password') {\r\n          input.setAttribute('autocomplete', 'new-password');\r\n          if (!input.dataset.ccReadOnlyBound) {\r\n            input.readOnly = true;\r\n            input.dataset.ccReadOnlyBound = '1';\r\n            input.addEventListener('focus', function () {\r\n              this.removeAttribute('readonly');\r\n            });\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    harden();\r\n\r\n    const observer = new MutationObserver(() => harden());\r\n    observer.observe(document.documentElement, { childList: true, subtree: true });\r\n    return () => observer.disconnect();\r\n  }, [disableAutofill, router.pathname]);\r\n\r\n  // Determine if we should wrap with layout\r\n  const isAdminPage = router.pathname.startsWith('/admin');\r\n  const isVendorPage = router.pathname.startsWith('/vendor');\r\n\r\n  // Use the layout defined at the page level, if available\r\n  const getLayout = Component.getLayout ?? ((page) => page);\r\n\r\n  // Default content is the page itself (possibly wrapped by getLayout)\r\n  let content: ReactNode = getLayout(<Component {...pageProps} />);\r\n\r\n  if (isAdminPage) {\r\n    content = (\r\n      <DashboardLayout role=\"admin\">\r\n        <Component {...pageProps} />\r\n      </DashboardLayout>\r\n    );\r\n  } else if (isVendorPage) {\r\n    content = (\r\n      <DashboardLayout role=\"vendor\">\r\n        <Component {...pageProps} />\r\n      </DashboardLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* Global Google Identity Services Script - Load Once */}\r\n      <Script\r\n        src=\"https://accounts.google.com/gsi/client\"\r\n        strategy=\"afterInteractive\"\r\n        async\r\n        defer\r\n        onLoad={() => {\r\n          if (typeof window !== 'undefined') {\r\n            window.__GOOGLE_GIS_LOADED__ = true;\r\n            // Dispatch custom event for pages to listen\r\n            window.dispatchEvent(new Event('google-gis-loaded'));\r\n          }\r\n        }}\r\n        onError={() => {\r\n          console.error('Failed to load Google Identity Services script');\r\n        }}\r\n      />\r\n\r\n      <ToastProvider>\r\n        {/* FIX: AuthProvider must wrap CustomerStoreProvider so the store can access Auth context */}\r\n        <AuthProvider>\r\n          <CustomerStoreProvider>\r\n            {content}\r\n          </CustomerStoreProvider>\r\n        </AuthProvider>\r\n      </ToastProvider>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default MyApp;"],"names":[],"mappings":";;;;;AAgDA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkBA,SAAS,MAAM,EAAE,SAAS,EAAE,SAAS,EAAsB;IACzD,MAAM,SAAS,IAAA,gLAAS;IAExB,IAAA,gHAAS,EAAC;QACR,qBAAqB;QACrB,MAAM,aAAa,aAAa,OAAO,CAAC,eAAe;QACvD,SAAS,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,YAAY;IACnD,GAAG,EAAE;IAEL,IAAA,gHAAS,EAAC;QACR,MAAM,YAAY;YAChB;YACA;YACA;YACA;YACA;SACD;QAED,MAAM,mBAAmB;YACvB,UAAU,OAAO,CAAC,CAAC;gBACjB,SAAS,gBAAgB,CAAC,GAAG,OAAO,CAAC,CAAC,KAAO,GAAG,MAAM;YACxD;QACF;QAEA;QAEA,MAAM,WAAW,IAAI,iBAAiB,IAAM;QAC5C,SAAS,OAAO,CAAC,SAAS,eAAe,EAAE;YAAE,WAAW;YAAM,SAAS;QAAK;QAC5E,OAAO,IAAM,SAAS,UAAU;IAClC,GAAG,EAAE;IAEL,sDAAsD;IACtD,MAAM,kBAAkB,OAAO,QAAQ,KAAK;IAE5C,IAAA,gHAAS,EAAC;QACR,wCAAmC;;;QAEnC,MAAM;QAEN,MAAM;QAyCN,MAAM;IAGR,GAAG;QAAC;QAAiB,OAAO,QAAQ;KAAC;IAErC,0CAA0C;IAC1C,MAAM,cAAc,OAAO,QAAQ,CAAC,UAAU,CAAC;IAC/C,MAAM,eAAe,OAAO,QAAQ,CAAC,UAAU,CAAC;IAEhD,yDAAyD;IACzD,MAAM,YAAY,UAAU,SAAS,IAAI,CAAC,CAAC,OAAS,IAAI;IAExD,qEAAqE;IACrE,IAAI,UAAqB,wBAAU,qKAAC;QAAW,GAAG,SAAS;;;;;;IAE3D,IAAI,aAAa;QACf,wBACE,qKAAC,+LAAe;YAAC,MAAK;sBACpB,cAAA,qKAAC;gBAAW,GAAG,SAAS;;;;;;;;;;;IAG9B,OAAO,IAAI,cAAc;QACvB,wBACE,qKAAC,+LAAe;YAAC,MAAK;sBACpB,cAAA,qKAAC;gBAAW,GAAG,SAAS;;;;;;;;;;;IAG9B;IAEA,qBACE;;0BAEE,qKAAC,8KAAM;gBACL,KAAI;gBACJ,UAAS;gBACT,KAAK;gBACL,KAAK;gBACL,QAAQ;oBACN;;gBAKF;gBACA,SAAS;oBACP,QAAQ,KAAK,CAAC;gBAChB;;;;;;0BAGF,qKAAC,+LAAa;0BAEZ,cAAA,qKAAC,mLAAY;8BACX,cAAA,qKAAC,8LAAqB;kCACnB;;;;;;;;;;;;;;;;;;AAMb;uCAEe"}}]
}