{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/admin/dashboard.tsx"],"sourcesContent":["import { useEffect, useState, useMemo } from 'react';\r\n\r\ninterface Order {\r\n  _id: string;\r\n  orderNumber: string;\r\n  customerId: {\r\n    _id?: string;\r\n    name?: string;\r\n    email?: string;\r\n  };\r\n  vendorId: {\r\n    _id?: string;\r\n    name?: string;\r\n  };\r\n  pricing?: {\r\n    totalAmount?: number;\r\n  };\r\n  total?: number;\r\n  status: string;\r\n  createdAt?: string;\r\n}\r\n\r\ninterface Vendor {\r\n  _id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n  email?: string;\r\n}\r\n\r\ninterface Customer {\r\n  _id: string;\r\n  name?: string;\r\n  email?: string;\r\n  isActive?: boolean;\r\n}\r\n\r\nconst API_BASE = 'http://localhost:5000/api';\r\n\r\nexport default function AdminDashboard() {\r\n  const [orders, setOrders] = useState<Order[]>([]);\r\n  const [vendors, setVendors] = useState<Vendor[]>([]);\r\n  const [customers, setCustomers] = useState<Customer[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const [ordersRes, vendorsRes, customersRes] = await Promise.all([\r\n          fetch(`${API_BASE}/orders`),\r\n          fetch(`${API_BASE}/vendors`),\r\n          fetch(`${API_BASE}/customers`),\r\n        ]);\r\n\r\n        if (!ordersRes.ok || !vendorsRes.ok || !customersRes.ok) {\r\n          throw new Error('Failed to fetch data');\r\n        }\r\n\r\n        const ordersData = await ordersRes.json();\r\n        const vendorsData = await vendorsRes.json();\r\n        const customersData = await customersRes.json();\r\n\r\n        setOrders(Array.isArray(ordersData) ? ordersData : []);\r\n        setVendors(Array.isArray(vendorsData) ? vendorsData : []);\r\n        setCustomers(Array.isArray(customersData) ? customersData : []);\r\n      } catch (err: any) {\r\n        setError(err.message || 'Failed to load dashboard data');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  // Calculate stats from real data\r\n  const stats = useMemo(() => {\r\n    const totalVendors = vendors.length;\r\n    const totalCustomers = customers.length;\r\n    const totalOrders = orders.length;\r\n    \r\n    // Platform revenue is 5% of completed orders total value\r\n    const completedOrdersTotal = orders\r\n      .filter((o) => o.status === 'completed')\r\n      .reduce((sum, o) => {\r\n        const total = o.pricing?.totalAmount || o.total || 0;\r\n        return sum + total;\r\n      }, 0);\r\n    const platformRevenue = completedOrdersTotal * 0.05;\r\n\r\n    return [\r\n      { title: 'Total Vendors', value: totalVendors.toString() },\r\n      { title: 'Total Customers', value: totalCustomers.toString() },\r\n      { title: 'Total Orders', value: totalOrders.toString() },\r\n      { title: 'Platform Revenue', value: `₹${platformRevenue.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` },\r\n    ];\r\n  }, [vendors, customers, orders]);\r\n\r\n  // Calculate vendor onboarding stats\r\n  const onboarding = useMemo(() => ({\r\n    pendingKyc: vendors.filter((v) => !v.isActive).length,\r\n    awaitingApproval: 0, // This would require a separate status field in Vendor model\r\n    activeVendors: vendors.filter((v) => v.isActive).length,\r\n  }), [vendors]);\r\n\r\n  // Recent orders (last 5) - sorted by createdAt descending\r\n  const recentOrders = useMemo(() => {\r\n    return orders\r\n      .sort((a, b) => {\r\n        const dateA = new Date(a.createdAt || 0).getTime();\r\n        const dateB = new Date(b.createdAt || 0).getTime();\r\n        return dateB - dateA;\r\n      })\r\n      .slice(0, 5)\r\n      .map((o) => {\r\n        const totalAmount = o.pricing?.totalAmount || o.total || 0;\r\n        return {\r\n          id: o.orderNumber || o._id,\r\n          customer: o.customerId?.name || o.customerId?.email || 'Unknown',\r\n          vendor: o.vendorId?.name || 'Unknown',\r\n          total: `₹${totalAmount.toFixed(2)}`,\r\n          status: o.status || 'pending',\r\n        };\r\n      });\r\n  }, [orders]);\r\n\r\n  return (\r\n    <>\r\n      <h1 className=\"adm-title\">Admin Dashboard</h1>\r\n\r\n      {error && <div className=\"page-state error\">{error}</div>}\r\n\r\n      {loading && <div className=\"page-state\">Loading dashboard data…</div>}\r\n\r\n      {!loading && !error && (\r\n        <>\r\n          <div className=\"card-grid\">\r\n            {stats.map((s) => (\r\n              <div className=\"card\" key={s.title}>\r\n                <div className=\"card-title\">{s.title}</div>\r\n                <div className=\"card-value\">{s.value}</div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <section className=\"adm-section\">\r\n            <h2 className=\"section-title\">Recent Orders</h2>\r\n            {recentOrders.length === 0 ? (\r\n              <div className=\"page-state\">No orders yet.</div>\r\n            ) : (\r\n              <table className=\"table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Order ID</th>\r\n                    <th>Customer</th>\r\n                    <th>Vendor</th>\r\n                    <th>Total</th>\r\n                    <th>Status</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {recentOrders.map((o) => (\r\n                    <tr key={o.id}>\r\n                      <td>{o.id}</td>\r\n                      <td>{o.customer}</td>\r\n                      <td>{o.vendor}</td>\r\n                      <td>{o.total}</td>\r\n                      <td>\r\n                        <span className={`badge ${o.status === 'completed' ? 'success' : o.status === 'pending' ? 'warn' : o.status === 'cancelled' ? 'danger' : ''}`}>\r\n                          {o.status}\r\n                        </span>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </section>\r\n\r\n          <section className=\"adm-section\">\r\n            <h2 className=\"section-title\">Vendor Onboarding</h2>\r\n            <div className=\"adm-onboarding\">\r\n              <div className=\"card\">\r\n                <div className=\"card-title\">Inactive Vendors</div>\r\n                <div className=\"card-value\">{onboarding.pendingKyc}</div>\r\n              </div>\r\n              <div className=\"card\">\r\n                <div className=\"card-title\">Awaiting Approval</div>\r\n                <div className=\"card-value\">{onboarding.awaitingApproval}</div>\r\n              </div>\r\n              <div className=\"card\">\r\n                <div className=\"card-title\">Active Vendors</div>\r\n                <div className=\"card-value\">{onboarding.activeVendors}</div>\r\n              </div>\r\n            </div>\r\n          </section>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}