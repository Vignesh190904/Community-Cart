{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/vendor/dashboard.tsx"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name: string;\r\n  stock: number;\r\n}\r\n\r\ninterface Order {\r\n  _id: string;\r\n  orderNumber: string;\r\n  customerId: {\r\n    name?: string;\r\n    email?: string;\r\n  };\r\n  total?: number;\r\n  pricing?: {\r\n    subtotal?: number;\r\n    deliveryFee?: number;\r\n    tax?: number;\r\n    totalAmount?: number;\r\n  };\r\n  items?: Array<{\r\n    total?: number;\r\n  }>;\r\n  status: string;\r\n  createdAt: string;\r\n}\r\n\r\nconst API_BASE = 'http://localhost:5000/api';\r\n\r\nconst orderTotal = (order: Order) => {\r\n  const pricingTotal = order.pricing?.totalAmount;\r\n  if (typeof pricingTotal === 'number' && !Number.isNaN(pricingTotal)) return pricingTotal;\r\n\r\n  const itemsTotal = Array.isArray(order.items)\r\n    ? order.items.reduce((sum, item) => sum + (item.total || 0), 0)\r\n    : 0;\r\n\r\n  if (itemsTotal > 0) return itemsTotal;\r\n\r\n  if (typeof order.total === 'number' && !Number.isNaN(order.total)) return order.total;\r\n\r\n  return 0;\r\n};\r\n\r\nexport default function VendorDashboard() {\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [orders, setOrders] = useState<Order[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const { user } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (user?.id) {\r\n      fetchData(user.id);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  const fetchData = async (vendorId: string) => {\r\n    try {\r\n      setLoading(true);\r\n      const [productsRes, ordersRes] = await Promise.all([\r\n        fetch(`${API_BASE}/products`),\r\n        fetch(`${API_BASE}/orders?vendorId=${vendorId}`),\r\n      ]);\r\n\r\n      if (productsRes.ok) {\r\n        const allProducts = await productsRes.json();\r\n        const vendorProducts = allProducts.filter((p: any) => {\r\n          const pVendorId = typeof p.vendor === 'object' ? p.vendor._id : p.vendor;\r\n          return pVendorId === vendorId;\r\n        });\r\n        setProducts(vendorProducts);\r\n      }\r\n\r\n      if (ordersRes.ok) {\r\n        const ordersData = await ordersRes.json();\r\n        setOrders(ordersData);\r\n      }\r\n    } catch (error) {\r\n      // Silent error\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const stats = useMemo(() => {\r\n    const totalProducts = products.length;\r\n    const lowStockCount = products.filter((p) => p.stock <= 5).length;\r\n\r\n    const totalOrders = orders.filter((o) => o.status === 'completed' || o.status === 'cancelled').length;\r\n\r\n    const totalRevenue = orders\r\n      .filter((o) => o.status === 'completed')\r\n      .reduce((sum, o) => sum + orderTotal(o), 0);\r\n\r\n    return [\r\n      { title: 'Total Products', value: totalProducts.toString() },\r\n      { title: 'Total Orders', value: totalOrders.toString() },\r\n      { title: 'Total Revenue', value: `₹${totalRevenue.toLocaleString('en-IN')}` },\r\n      { title: 'Low Stock Items', value: lowStockCount.toString() },\r\n    ];\r\n  }, [products, orders]);\r\n\r\n  const recentOrders = useMemo(() => {\r\n    return orders\r\n      .slice(0, 5)\r\n      .map((o) => ({\r\n        id: o.orderNumber,\r\n        customer: o.customerId?.name || o.customerId?.email || 'Unknown',\r\n        total: `₹${orderTotal(o).toFixed(2)}`,\r\n        status: o.status.charAt(0).toUpperCase() + o.status.slice(1),\r\n        statusClass: o.status === 'completed' ? 'success' : o.status === 'cancelled' ? 'danger' : o.status === 'pending' ? 'warn' : '',\r\n      }));\r\n  }, [orders]);\r\n\r\n  const lowStock = useMemo(() => {\r\n    return products\r\n      .filter((p) => p.stock <= 5)\r\n      .sort((a, b) => a.stock - b.stock)\r\n      .slice(0, 5)\r\n      .map((p) => ({\r\n        sku: p._id.slice(-8).toUpperCase(),\r\n        name: p.name,\r\n        qty: p.stock,\r\n      }));\r\n  }, [products]);\r\n\r\n  if (loading) {\r\n    return <div className=\"page-state\">Loading dashboard…</div>;\r\n  }\r\n\r\n  if (!user?.id) {\r\n    return <div className=\"page-state\">Please login to view your vendor dashboard.</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <h1 className=\"ven-title\">Vendor Dashboard</h1>\r\n      <div className=\"card-grid\">\r\n        {stats.map((s) => (\r\n          <div className=\"card\" key={s.title}>\r\n            <div className=\"card-title\">{s.title}</div>\r\n            <div className=\"card-value\">{s.value}</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <section className=\"ven-section\">\r\n        <h2 className=\"section-title\">Recent Orders</h2>\r\n        {recentOrders.length === 0 ? (\r\n          <div className=\"page-state\">No orders yet.</div>\r\n        ) : (\r\n          <div className=\"list\">\r\n            {recentOrders.map((o) => (\r\n              <div className=\"list-item\" key={o.id}>\r\n                <div>\r\n                  <div>{o.id} • {o.customer}</div>\r\n                  <div className=\"card-title\">Total: {o.total}</div>\r\n                </div>\r\n                <span className={`badge ${o.statusClass}`}>{o.status}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      <section className=\"ven-section\">\r\n        <h2 className=\"section-title\">Low Stock Alerts</h2>\r\n        {lowStock.length === 0 ? (\r\n          <div className=\"page-state\">All products have adequate stock.</div>\r\n        ) : (\r\n          <div className=\"list\">\r\n            {lowStock.map((i) => (\r\n              <div className=\"list-item\" key={i.sku}>\r\n                <div>\r\n                  <div>{i.name}</div>\r\n                  <div className=\"card-title\">SKU-{i.sku}</div>\r\n                </div>\r\n                <span className={`badge danger`}>Qty: {i.qty}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </section>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}