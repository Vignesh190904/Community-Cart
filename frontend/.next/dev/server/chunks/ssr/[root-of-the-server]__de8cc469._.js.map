{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/customer/signin.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useRouter } from 'next/router';\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\nexport default function SignIn() {\r\n    const router = useRouter();\r\n    const { sign_in, is_authenticated, loading: auth_loading } = useAuth();\r\n\r\n    const [show_password, set_show_password] = useState(false);\r\n    const [email, set_email] = useState('');\r\n    const [password, set_password] = useState('');\r\n    const [error, set_error] = useState('');\r\n    const [loading, set_loading] = useState(false);\r\n\r\n    const google_initialized = useRef(false);\r\n    const [is_google_ready, set_is_google_ready] = useState(false);\r\n\r\n    // 1. MANUAL SIGN IN\r\n    const handle_manual_signin = async () => {\r\n        set_loading(true);\r\n        set_error('');\r\n        try {\r\n            const res = await fetch('http://localhost:5000/api/auth/customer/signin/manual', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ email, password }),\r\n                credentials: 'include'\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (res.status === 404) {\r\n                set_error(\"Account doesn't exist. Please sign up.\");\r\n                return;\r\n            }\r\n\r\n            if (!res.ok) throw new Error(data.message || 'Login failed');\r\n\r\n            sign_in(data.user);\r\n            router.push('/customer/home');\r\n        } catch (err: any) {\r\n            set_error(err.message);\r\n        } finally {\r\n            set_loading(false);\r\n        }\r\n    };\r\n\r\n    // 2. GOOGLE SIGN IN\r\n    const handle_google_response = useCallback(async (response: any) => {\r\n        set_loading(true);\r\n        set_error('');\r\n        try {\r\n            const res = await fetch('http://localhost:5000/api/auth/customer/signin/google', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ token: response.credential }),\r\n                credentials: 'include'\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (res.status === 404) {\r\n                set_error(\"No account found with this Google email. Please sign up.\");\r\n                return;\r\n            }\r\n\r\n            if (!res.ok) throw new Error(data.message || 'Google login failed');\r\n\r\n            sign_in(data.user);\r\n            router.push('/customer/home');\r\n        } catch (err: any) {\r\n            set_error(err.message);\r\n        } finally {\r\n            set_loading(false);\r\n        }\r\n    }, [sign_in, router]);\r\n\r\n    // 3. GOOGLE INITIALIZATION\r\n    const init_google = useCallback(() => {\r\n        if (is_authenticated) return;\r\n        const client_id = process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID;\r\n        const container = document.getElementById('google-btn-container');\r\n        if (!window.google?.accounts?.id || !container || google_initialized.current) return;\r\n\r\n        window.google.accounts.id.initialize({\r\n            client_id: client_id!,\r\n            callback: handle_google_response,\r\n            ux_mode: 'popup',\r\n        });\r\n        window.google.accounts.id.renderButton(container, { theme: 'outline', size: 'large', width: 320 });\r\n        google_initialized.current = true;\r\n        set_is_google_ready(true);\r\n    }, [handle_google_response, is_authenticated]);\r\n\r\n    useEffect(() => {\r\n        if (is_authenticated && !auth_loading) router.replace('/customer/home');\r\n    }, [is_authenticated, auth_loading, router]);\r\n\r\n    useEffect(() => {\r\n        const check_and_init = () => {\r\n            if (typeof window !== 'undefined' && window.__GOOGLE_GIS_LOADED__) init_google();\r\n        };\r\n        check_and_init();\r\n        window.addEventListener('google-gis-loaded', check_and_init);\r\n        return () => window.removeEventListener('google-gis-loaded', check_and_init);\r\n    }, [init_google]);\r\n\r\n    return (\r\n        <div className=\"signin-page\">\r\n            <div className=\"signin-container\">\r\n                <h1 className=\"signin-title\">Sign In</h1>\r\n                {error && <p style={{ color: 'red', textAlign: 'center', marginBottom: '10px' }}>{error}</p>}\r\n\r\n                <div className=\"input-group\">\r\n                    <div className=\"input-field\">\r\n                        <input type=\"email\" className=\"input-text\" value={email} onChange={(e) => set_email(e.target.value)} placeholder=\"Email\" />\r\n                        <label className=\"input-label\">Email</label>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"input-group\">\r\n                    <div className=\"input-field\">\r\n                        <input type={show_password ? 'text' : 'password'} className=\"input-text\" value={password} onChange={(e) => set_password(e.target.value)} placeholder=\"Password\" />\r\n                        <label className=\"input-label\">Password</label>\r\n                        <img\r\n                            src={show_password ? '/customer/assets/icons/view.svg' : '/customer/assets/icons/hide.svg'}\r\n                            alt=\"toggle\"\r\n                            className=\"input-icon-right password-toggle\"\r\n                            onClick={() => set_show_password(!show_password)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <button className=\"signin-button\" onClick={handle_manual_signin} disabled={loading}>\r\n                    {loading ? 'Signing In...' : 'Sign In'}\r\n                </button>\r\n\r\n                <div className=\"signup-row\">\r\n                    <span>Don't have account? </span>\r\n                    <button className=\"signup-link\" onClick={() => router.push('/customer/signup')}>Sign Up</button>\r\n                </div>\r\n\r\n                <div style={{ marginTop: '20px', width: '100%', position: 'relative' }}>\r\n                    <div id=\"google-btn-container\" style={{ width: '100%', display: 'flex', justifyContent: 'center' }} />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}"],"names":[],"mappings":"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"}}]
}