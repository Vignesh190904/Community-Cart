{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/customer/verify-otp.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { useEffect, useRef, useState } from 'react';\r\n\r\nexport default function VerifyOtp() {\r\n    const router = useRouter();\r\n    const params = useSearchParams();\r\n\r\n    const intent = params.get('intent'); // manual_signup | google_signup | signup_phone | google_signup_phone\r\n    const email = params.get('email') || '';\r\n    const mobile = params.get('mobile') || '';\r\n\r\n    const [otp, setOtp] = useState<string[]>(Array(6).fill(''));\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    const inputRefs = useRef<(HTMLInputElement | null)[]>([]);\r\n\r\n    useEffect(() => {\r\n        inputRefs.current[0]?.focus();\r\n    }, []);\r\n\r\n    const handleChange = (val: string, idx: number) => {\r\n        if (!/^\\d?$/.test(val)) return;\r\n        const copy = [...otp];\r\n        copy[idx] = val;\r\n        setOtp(copy);\r\n        if (val && idx < 5) inputRefs.current[idx + 1]?.focus();\r\n    };\r\n\r\n    const handleVerify = async () => {\r\n        const otpValue = otp.join('');\r\n        if (otpValue.length !== 6) {\r\n            setError('Enter 6-digit OTP');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            /** ===============================\r\n             * EMAIL OTP STEP\r\n             * =============================== */\r\n            if (intent === 'manual_signup' || intent === 'google_signup') {\r\n                if (!email) throw new Error('Email missing. Restart signup.');\r\n\r\n                const res = await fetch(\r\n                    'http://localhost:5000/api/auth/customer/signup/verify-email',\r\n                    {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ email, otp: otpValue }),\r\n                    }\r\n                );\r\n\r\n                const data = await res.json();\r\n                if (!res.ok) throw new Error(data.message || 'Email OTP failed');\r\n\r\n                router.push(\r\n                    `/customer/verify-mobile?intent=${intent === 'manual_signup'\r\n                        ? 'signup_phone'\r\n                        : 'google_signup_phone'\r\n                    }&email=${encodeURIComponent(email)}`\r\n                );\r\n                return;\r\n            }\r\n\r\n            /** ===============================\r\n             * MOBILE OTP STEP\r\n             * =============================== */\r\n            if (intent === 'signup_phone' || intent === 'google_signup_phone') {\r\n                if (!email || !mobile)\r\n                    throw new Error('Email or mobile missing.');\r\n\r\n                const res = await fetch(\r\n                    'http://localhost:5000/api/auth/customer/signup/verify-mobile',\r\n                    {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ email, mobile, otp: otpValue }),\r\n                    }\r\n                );\r\n\r\n                const data = await res.json();\r\n                if (!res.ok) throw new Error(data.message || 'Mobile OTP failed');\r\n\r\n                const finalizeEndpoint =\r\n                    intent === 'google_signup_phone'\r\n                        ? '/api/auth/customer/google/signup/finalize'\r\n                        : '/api/auth/customer/signup/finalize';\r\n\r\n                const finalRes = await fetch(\r\n                    `http://localhost:5000${finalizeEndpoint}`,\r\n                    {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ email }),\r\n                    }\r\n                );\r\n\r\n                const finalData = await finalRes.json();\r\n                if (!finalRes.ok)\r\n                    throw new Error(finalData.message || 'Signup failed');\r\n\r\n                localStorage.setItem('auth_token', finalData.token);\r\n                router.push('/customer/home');\r\n                return;\r\n            }\r\n\r\n            throw new Error('Invalid signup state. Restart signup.');\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n            setOtp(Array(6).fill(''));\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"otp-page\">\r\n            <h2>Enter OTP</h2>\r\n\r\n            {error && <p style={{ color: 'red' }}>{error}</p>}\r\n\r\n            <div className=\"otp-inputs\">\r\n                {otp.map((d, i) => (\r\n                    <input\r\n                        key={i}\r\n                        maxLength={1}\r\n                        value={d}\r\n                        onChange={(e) => handleChange(e.target.value, i)}\r\n                        ref={(el) => { inputRefs.current[i] = el }}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n            <button onClick={handleVerify} disabled={loading}>\r\n                {loading ? 'Verifying...' : 'Verify'}\r\n            </button>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}