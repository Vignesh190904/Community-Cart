{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/vigne/Desktop/Community-Cart/frontend/src/pages/vendor/earnings.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\r\nimport styles from './earnings.module.css';\r\n\r\ninterface MetricsResponse {\r\n  filters: {\r\n    from: string | null;\r\n    to: string | null;\r\n    status: string[];\r\n  };\r\n  metrics: {\r\n    totalEarnings: number;\r\n    totalCancelledValue: number;\r\n    completedOrdersCount: number;\r\n    cancelledOrdersCount: number;\r\n    totalUnitsSold: number;\r\n    customersServed: number;\r\n    averageOrderValue: number;\r\n  };\r\n}\r\n\r\ntype Preset = 'today' | 'week' | 'month' | 'year' | 'all' | 'custom';\r\ntype StatusFilter = 'both' | 'completed' | 'cancelled';\r\n\r\nconst API_BASE = 'http://localhost:5000/api';\r\n\r\nconst formatDate = (d: Date) => d.toISOString().slice(0, 10);\r\n\r\nconst getPresetRange = (preset: Preset) => {\r\n  const now = new Date();\r\n  const start = new Date(now);\r\n\r\n  if (preset === 'today') {\r\n    return { from: formatDate(start), to: formatDate(now) };\r\n  }\r\n\r\n  if (preset === 'week') {\r\n    const day = start.getDay();\r\n    const diff = day === 0 ? 6 : day - 1; // Monday start\r\n    start.setDate(start.getDate() - diff);\r\n    return { from: formatDate(start), to: formatDate(now) };\r\n  }\r\n\r\n  if (preset === 'month') {\r\n    start.setDate(1);\r\n    return { from: formatDate(start), to: formatDate(now) };\r\n  }\r\n\r\n  if (preset === 'year') {\r\n    start.setMonth(0, 1);\r\n    return { from: formatDate(start), to: formatDate(now) };\r\n  }\r\n\r\n  if (preset === 'all') {\r\n    return { from: '', to: '' };\r\n  }\r\n\r\n  return { from: '', to: '' };\r\n};\r\n\r\nexport default function VendorEarnings() {\r\n  const [metrics, setMetrics] = useState<MetricsResponse['metrics'] | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  const [preset, setPreset] = useState<Preset>('month');\r\n  const [fromDate, setFromDate] = useState<string>('');\r\n  const [toDate, setToDate] = useState<string>('');\r\n  const [status, setStatus] = useState<StatusFilter>('both');\r\n\r\n  const [vendorId, setVendorId] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const storedVendorId =\r\n      localStorage.getItem('cc_vendorId') ||\r\n      localStorage.getItem('vendorId') ||\r\n      '';\r\n    setVendorId(storedVendorId);\r\n  }, []);\r\n\r\n  const statusQuery = useMemo(() => {\r\n    if (status === 'both') return 'completed,cancelled';\r\n    return status;\r\n  }, [status]);\r\n\r\n  const computedDates = useMemo(() => {\r\n    if (preset === 'custom') return { from: fromDate, to: toDate };\r\n    return getPresetRange(preset);\r\n  }, [preset, fromDate, toDate]);\r\n\r\n  const fetchMetrics = async () => {\r\n    if (!vendorId) {\r\n      setError('Vendor not found. Please sign in again.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const params = new URLSearchParams();\r\n      params.set('status', statusQuery);\r\n      if (computedDates.from) params.set('from', computedDates.from);\r\n      if (computedDates.to) params.set('to', computedDates.to);\r\n\r\n      const res = await fetch(`${API_BASE}/vendors/${vendorId}/earnings?${params.toString()}`);\r\n      if (!res.ok) throw new Error('Failed to fetch earnings');\r\n      const data: MetricsResponse = await res.json();\r\n      setMetrics(data.metrics);\r\n    } catch (err: any) {\r\n      setError(err.message || 'Failed to load earnings');\r\n      setMetrics(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchMetrics();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [preset, fromDate, toDate, statusQuery, vendorId]);\r\n\r\n  const handlePresetChange = (value: Preset) => {\r\n    setPreset(value);\r\n    if (value !== 'custom') {\r\n      const range = getPresetRange(value);\r\n      setFromDate(range.from);\r\n      setToDate(range.to);\r\n    }\r\n  };\r\n\r\n  const handleCustomDateChange = (field: 'from' | 'to', value: string) => {\r\n    setPreset('custom');\r\n    if (field === 'from') setFromDate(value);\r\n    if (field === 'to') setToDate(value);\r\n  };\r\n\r\n  const valueOrDash = (val?: number) =>\r\n    typeof val === 'number' && !Number.isNaN(val) ? val.toFixed(2) : '—';\r\n\r\n  return (\r\n    <div className={styles.vendorEarningsPage}>\r\n      <header className={styles.pageHeader}>\r\n        <div>\r\n          <p className={styles.pageKicker}>Vendor</p>\r\n          <h1 className={styles.pageTitle}>Earnings</h1>\r\n          <p className={styles.pageSubtitle}>Business performance at a glance</p>\r\n        </div>\r\n      </header>\r\n\r\n      <section className={styles.filtersPanel}>\r\n        <div className={styles.filterGroup}>\r\n          <p className={styles.filterLabel}>Date Preset</p>\r\n          <div className={styles.presetRow}>\r\n            {[\r\n              { id: 'today', label: 'Today' },\r\n              { id: 'week', label: 'This Week' },\r\n              { id: 'month', label: 'This Month' },\r\n              { id: 'year', label: 'This Year' },\r\n              { id: 'all', label: 'All Time' },\r\n            ].map((option) => (\r\n              <button\r\n                key={option.id}\r\n                className={`${styles.chip} ${preset === option.id ? styles.active : ''}`}\r\n                onClick={() => handlePresetChange(option.id as Preset)}\r\n              >\r\n                {option.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <div className={styles.filterGroup}>\r\n          <p className={styles.filterLabel}>Custom Range</p>\r\n          <div className={styles.dateRow}>\r\n            <label className={styles.dateInput}>\r\n              <span>From</span>\r\n              <input\r\n                type=\"date\"\r\n                value={fromDate}\r\n                onChange={(e) => handleCustomDateChange('from', e.target.value)}\r\n              />\r\n            </label>\r\n            <label className={styles.dateInput}>\r\n              <span>To</span>\r\n              <input\r\n                type=\"date\"\r\n                value={toDate}\r\n                onChange={(e) => handleCustomDateChange('to', e.target.value)}\r\n              />\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        <div className={styles.filterGroup}>\r\n          <p className={styles.filterLabel}>Status</p>\r\n          <div className={styles.statusRow}>\r\n            <label className={styles.statusOption}>\r\n              <input\r\n                type=\"radio\"\r\n                name=\"status\"\r\n                value=\"both\"\r\n                checked={status === 'both'}\r\n                onChange={() => setStatus('both')}\r\n              />\r\n              <span>Both</span>\r\n            </label>\r\n            <label className={styles.statusOption}>\r\n              <input\r\n                type=\"radio\"\r\n                name=\"status\"\r\n                value=\"completed\"\r\n                checked={status === 'completed'}\r\n                onChange={() => setStatus('completed')}\r\n              />\r\n              <span>Completed only</span>\r\n            </label>\r\n            <label className={styles.statusOption}>\r\n              <input\r\n                type=\"radio\"\r\n                name=\"status\"\r\n                value=\"cancelled\"\r\n                checked={status === 'cancelled'}\r\n                onChange={() => setStatus('cancelled')}\r\n              />\r\n              <span>Cancelled only</span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {loading && (\r\n        <div className={styles.stateBox}>Loading earnings…</div>\r\n      )}\r\n\r\n      {error && !loading && (\r\n        <div className={`${styles.stateBox} ${styles.error}`}>{error}</div>\r\n      )}\r\n\r\n      {!loading && !error && !metrics && (\r\n        <div className={styles.stateBox}>No data available for the selected filters.</div>\r\n      )}\r\n\r\n      {!loading && !error && metrics && (\r\n        <section className={styles.metricsGrid}>\r\n          <article className={styles.metricCard}>\r\n            <p className={styles.metricLabel}>Total Earnings</p>\r\n            <p className={`${styles.metricValue} ${styles.primary}`}>₹{valueOrDash(metrics.totalEarnings)}</p>\r\n          </article>\r\n          <article className={styles.metricCard}>\r\n            <p className={styles.metricLabel}>Cancelled Order Value</p>\r\n            <p className={`${styles.metricValue} ${styles.danger}`}>₹{valueOrDash(metrics.totalCancelledValue)}</p>\r\n          </article>\r\n          <article className={styles.metricCard}>\r\n            <p className={styles.metricLabel}>Completed Orders</p>\r\n            <p className={styles.metricValue}>{metrics.completedOrdersCount}</p>\r\n          </article>\r\n          <article className={styles.metricCard}>\r\n            <p className={styles.metricLabel}>Cancelled Orders</p>\r\n            <p className={styles.metricValue}>{metrics.cancelledOrdersCount}</p>\r\n          </article>\r\n          <article className={styles.metricCard}>\r\n            <p className={styles.metricLabel}>Total Units Sold</p>\r\n            <p className={styles.metricValue}>{metrics.totalUnitsSold}</p>\r\n          </article>\r\n          <article className={styles.metricCard}>\r\n            <p className={styles.metricLabel}>Customers Served</p>\r\n            <p className={styles.metricValue}>{metrics.customersServed}</p>\r\n          </article>\r\n          <article className={styles.metricCard}>\r\n            <p className={styles.metricLabel}>Average Order Value</p>\r\n            <p className={styles.metricValue}>₹{valueOrDash(metrics.averageOrderValue)}</p>\r\n          </article>\r\n        </section>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}